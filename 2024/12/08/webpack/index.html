

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="MrZ">
  <meta name="keywords" content="">
  
    <meta name="description" content="前言  从Webpack开始的前端工程化探索 模块化  随着前端应用的日益复杂，程序员需要更高效的代码组织形式，以便提高可维护性并提升开发效率。 模块化将复杂的代码按功能的不同，分为不同的模块，单独维护，提高开发效率。 模块：  将一个复杂的程序依据一定的规则(规范)封装成几个块(文件), 并进行组合在一起。 块的内部数据与实现是私有的, 只是向外部暴露一些接口(方法)与外部其它模块通信。  演变">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack">
<meta property="og:url" content="http://example.com/2024/12/08/webpack/index.html">
<meta property="og:site_name" content="MrZ的个人博客">
<meta property="og:description" content="前言  从Webpack开始的前端工程化探索 模块化  随着前端应用的日益复杂，程序员需要更高效的代码组织形式，以便提高可维护性并提升开发效率。 模块化将复杂的代码按功能的不同，分为不同的模块，单独维护，提高开发效率。 模块：  将一个复杂的程序依据一定的规则(规范)封装成几个块(文件), 并进行组合在一起。 块的内部数据与实现是私有的, 只是向外部暴露一些接口(方法)与外部其它模块通信。  演变">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-08T13:08:13.000Z">
<meta property="article:modified_time" content="2024-12-08T13:09:24.091Z">
<meta property="article:author" content="MrZ">
<meta property="article:tag" content="模块化">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>webpack - MrZ的个人博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>MirZ Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="webpack"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-08 21:08" pubdate>
          2024年12月8日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          126 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">webpack</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="ztgII">前言</h1>

<p><font style="color:rgb(53, 53, 53);">从Webpack开始的前端工程化探索</font></p>
<h1 id="dCQEd">模块化</h1>

<p><font style="color:rgb(53, 53, 53);">随着前端应用的日益复杂，程序员需要更高效的代码组织形式，以便提高可维护性并提升开发效率。</font></p>
<p><font style="color:rgb(53, 53, 53);">模块化将复杂的代码按功能的不同，分为不同的模块，单独维护，提高开发效率。</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">模块：</font></strong></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">将一个复杂的程序依据一定的规则(规范)封装成几个块(文件), 并进行组合在一起。</font></li>
<li><font style="color:rgb(53, 53, 53);">块的内部数据与实现是私有的, 只是向外部暴露一些接口(方法)与外部其它模块通信。</font></li>
</ol>
<h2 id="ZNsRX">演变</h2>

<p><strong><font style="color:rgb(53, 53, 53);">1、文件划分</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">将不同的功能及其状态数据存放在单独的JS文件中。约定一个文件就是一个模块，以单独的script标签引入至HTML。</font></p>
<p><font style="color:rgb(53, 53, 53);">虽然实现了功能的划分，但缺点也十分明显：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">污染全局作用域</font></li>
<li><font style="color:rgb(53, 53, 53);">命名冲突</font></li>
<li><font style="color:rgb(53, 53, 53);">无法管理模块的依赖关系</font></li>
</ol>
<p><strong><font style="color:rgb(53, 53, 53);">2、命名空间</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">在文件划分的基础上，约定每个模块只暴露一个全局的对象，对象包裹着模块的方法和状态。</font></p>
<p><font style="color:rgb(53, 53, 53);">虽然避免了命名冲突，但仍然没有私有空间，</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">3、IIFE</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">通过立即执行函数实现私有空间，使用window暴露模块的成员，通过参数声明依赖。</font></p>
<p><strong>js</strong></p>
<p><font style="color:rgb(53, 53, 53);">在没有工具和相关规范的早期，以约定的形式，实践模块化思想的方式。</font></p>
<p><font style="color:rgb(53, 53, 53);">仍然存在问题：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">依赖管理混乱</font></li>
<li><font style="color:rgb(53, 53, 53);">不同开发者、不同项目，模块化的实现有差异</font></li>
<li><font style="color:rgb(53, 53, 53);">模块的导入不受代码控制</font></li>
</ol>
<h3 id="FjzOd">现代化</h3>

<ol>
<li><strong><font style="color:rgb(53, 53, 53);">模块化规范：</font></strong><font style="color:rgb(53, 53, 53);">对模块代码书写格式和交互规则的详细描述</font></li>
<li><strong><font style="color:rgb(53, 53, 53);">模块加载器：</font></strong><font style="color:rgb(53, 53, 53);">使用代码的方式，自动控制模块的导入，管理模块的依赖。</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">在ES6模块化出现之前，为了解决模块化的需求，出现了众多的模块化机制，CommonJS(NodeJS内置)、AMD(require.js)、CMD(Sea.js)</font></p>
<p><font style="color:rgb(53, 53, 53);">ES6模块化出现后的</font><strong><font style="color:rgb(53, 53, 53);">最佳实践</font></strong><font style="color:rgb(53, 53, 53);">：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">浏览器环境：ES Module</font></li>
<li><font style="color:rgb(53, 53, 53);">Node环境：CommonJS</font></li>
</ol>
<h2 id="gt4Tx">ES Module</h2>

<p><font style="color:rgb(53, 53, 53);">ES6 模块的设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系，以及输入和输出的变量，而 CommonJS 和 AMD 模块，都是运行时的</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;script type=&#x27;module&#x27;&gt;<br>  import &#123; name &#125; from &#x27;./modules/index.js&#x27;;<br>  export name;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">特性：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">自动采用严格模式，忽略’use strict’</font></li>
<li><font style="color:rgb(53, 53, 53);">每个ESM模块都是单独的私有作用域</font></li>
<li><font style="color:rgb(53, 53, 53);">ESM通过CORS请求外部JS模块</font></li>
<li><font style="color:rgb(53, 53, 53);">ESM的script标签会延迟执行脚本(相当于defer)</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">详见</font><a target="_blank" rel="noopener" href="https://www.qcqx.cn/article/383b041f.html#Module%E6%A8%A1%E5%9D%97%E5%8C%96"><font style="color:rgb(53, 53, 53);">ES6查缺补漏 #Module模块化</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules"><font style="color:rgb(53, 53, 53);">MDN-JavaScript模块</font></a></p>
<h3 id="aTsbD">兼容性问题</h3>

<p><font style="color:rgb(53, 53, 53);">ES6仍然有兼容性问题，早期的浏览器，特别是国产和手机上的浏览器</font></p>
<p><strong>shell</strong></p>
<p>使用 caniuse-cmd 检查兼容性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm install -g caniuse-cmd<br>caniuse import<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">可以引入</font><font style="color:rgb(53, 53, 53);"> </font><a target="_blank" rel="noopener" href="https://polyfill.io/"><font style="color:rgb(53, 53, 53);">Polyfill</font></a><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">兼容</font></p>
<p><font style="color:rgb(53, 53, 53);">使用 webpack、vite 后，有更多的兼容插件可以安装使用，如</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;@vitejs/plugin-legacy&lt;/font&gt;</code></p>
<p><font style="color:rgb(53, 53, 53);">script添加nomodule属性，仅在不支持ESM的浏览器上执行该脚本</font></p>
<h3 id="tWXEu">ESM in Node</h3>

<p><font style="color:rgb(53, 53, 53);">ESM在Node.js的v8.5.0中作为实验性功能被引入，v12.17.0为所有Node.js应用程序提供了ESM支持</font></p>
<p><font style="color:rgb(53, 53, 53);">使用</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;.mjs&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">、</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;.cjs&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">文件后缀区分 ESM 和 CommonJS 模块</font></p>
<p><font style="color:rgb(53, 53, 53);">原生Node环境中的ESM与CommonJS：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">ES Module中可以导入CommonJS模块</font></li>
<li><font style="color:rgb(53, 53, 53);">CommonJS中不能导入ES Module模块</font></li>
<li><font style="color:rgb(53, 53, 53);">CommonJS始终只会导出一个默认成员</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">ESM得到CommonJS全局成员的值：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">// console.log(__dirname)<br>// ReferenceError: __dirname is not defined in ES module scope<br>import &#123; fileURLToPath &#125; from &#x27;url&#x27;<br>import &#123; dirname &#125; from &#x27;path&#x27;<br>const __filename = fileURLToPath(import.meta.url)<br>const __dirname = dirname(__filename)<br>console.log(__filename)<br>console.log(__dirname)<br>// c:\***\esm-in-node\index.mjs<br>// c:\***\esm-in-node<br></code></pre></td></tr></table></figure>

<h2 id="y8o51">前端打包工具</h2>

<p><font style="color:rgb(53, 53, 53);">ESM仍然存在一些问题：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">存在兼容性问题</font></li>
<li><font style="color:rgb(53, 53, 53);">模块文件过多，网络请求频繁</font></li>
<li><font style="color:rgb(53, 53, 53);">不仅是JS，前端所有的资源，包括CSS、HTML都需要模块化</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">前端需要更好的工具和规范，让开发者继续享受模块化带来的便利，而不需要担心对</font><strong><font style="color:rgb(53, 53, 53);">生产环境</font></strong><font style="color:rgb(53, 53, 53);">产生的影响。</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">需求推动技术的进步</font></strong><font style="color:rgb(53, 53, 53);">，打包工具顺势出现了。打包工具解决的是前端整体的模块化，不只是局限于JS的模块化。</font></p>
<p><font style="color:rgb(53, 53, 53);">如今前端项目的代码组织，已经走上了</font><strong><font style="color:rgb(53, 53, 53);">编辑代码</font></strong><font style="color:rgb(53, 53, 53);">和</font><strong><font style="color:rgb(53, 53, 53);">最终运行文件</font></strong><font style="color:rgb(53, 53, 53);">完全两样的形式，一系列</font><strong><font style="color:rgb(53, 53, 53);">工具链</font></strong><font style="color:rgb(53, 53, 53);">和自动化的思想也融入进了打包工具中，打包也逐渐从一个技术问题，转变为了生态和管理问题。打包工具现在也可称为</font><strong><font style="color:rgb(53, 53, 53);">构建工具</font></strong><font style="color:rgb(53, 53, 53);">，支撑着前端工程化。</font></p>
<p><font style="color:rgb(53, 53, 53);">常见的打包工具：</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/"><font style="color:rgb(53, 53, 53);">Webpack</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://vitejs.dev/"><font style="color:rgb(53, 53, 53);">Vite</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://rollupjs.org/"><font style="color:rgb(53, 53, 53);">Rollup</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://esbuild.github.io/"><font style="color:rgb(53, 53, 53);">esbuild</font></a></p>
<h1 id="uHXZM">Webpack</h1>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/"><font style="color:rgb(53, 53, 53);">Webpack</font></a><font style="color:rgb(53, 53, 53);">是一个用于现代 JavaScript 应用程序的静态模块打包工具。</font></p>
<p><font style="color:rgb(53, 53, 53);">学习webpack大体上就是学习webpack.config.js的配置、各种loaders和plugins的使用，所以，多看文档，广泛了解，取所需使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/"><font style="color:rgb(53, 53, 53);">文档</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/"><font style="color:rgb(53, 53, 53);">配置</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/"><font style="color:rgb(53, 53, 53);">指南</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/"><font style="color:rgb(53, 53, 53);">loaders</font></a><font style="color:rgb(53, 53, 53);">、</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/"><font style="color:rgb(53, 53, 53);">plugins</font></a></p>
<h2 id="yrYsD">快速上手</h2>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm init -y<br>npm install webpack webpack-cli --save-dev<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;private&quot;: true, // 防止意外发布<br>  &quot;scripts&quot;: &#123;<br>    &quot;build&quot;: &quot;webpack&quot; // 打包命令<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">创建index.html和src目录，并写两个模块化文件：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>  &lt;meta charset=&quot;UTF-8&quot;&gt;<br>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>  &lt;title&gt;Document&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>  &lt;script type=&quot;module&quot; src=&quot;src/index.js&quot;&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; createTitle &#125; from &quot;./module.js&quot;;<br>document.body.append(createTitle(&#x27;Hello World&#x27;));<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">export const createTitle = (title) =&gt; &#123;<br>  const element = document.createElement(&#x27;h2&#x27;)<br>  element.textContent = title<br>  element.addEventListener(&#x27;click&#x27;, () =&gt; &#123;<br>    alert(title)<br>  &#125;)<br>  return element<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">直接打开 index.html 可以看到页面上的 Hello World</font></p>
<p><font style="color:rgb(53, 53, 53);">接着使用webpack进行打包</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">npx webpack<br># 或<br>npm run build<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">webpack自动创建了 dist 目录，存放了打包好的 main.js</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;!-- &lt;script type=&quot;module&quot; src=&quot;src/index.js&quot;&gt;&lt;/script&gt; --&gt;<br>&lt;!-- 打包好的main.js已经是ES5语法，可以去掉type=&quot;module&quot; --&gt;<br>&lt;script src=&quot;dist/main.js&quot;&gt;&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">打开 index.html 仍然可以看到 Hello World</font></p>
<p><font style="color:rgb(53, 53, 53);">Webpack4以后，支持这样0配置的方式，快速打包项目，src是默认打包入口，dist是输出，index.js -&gt; main.js</font></p>
<h1 id="E4MOi">配置</h1>

<p><font style="color:rgb(53, 53, 53);">根目录的</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;webpack.config.js&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">是webpack默认的配置文件</font></p>
<p><font style="color:rgb(53, 53, 53);">可以手动创建配置文件，或在 VSCode 中下载</font><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=jeremyrajan.webpack"><font style="color:rgb(53, 53, 53);">webpack插件</font></a><font style="color:rgb(53, 53, 53);">，通过</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;Webpack Create&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">命令，初始化 webpack</font></p>
<p><strong>默认创建的wbpack.config.js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs plain">const path = require(&#x27;path&#x27;);<br>module.exports = &#123;<br>  // 设置模式为开发模式<br>  mode: &#x27;development&#x27;,<br>  // 应用程序的入口点<br>  entry: path.join(__dirname, &#x27;src&#x27;, &#x27;index&#x27;),<br>  // 启用监视模式，以在文件更改时进行自动重新编译<br>  watch: true,<br>  // 输出配置<br>  output: &#123;<br>    // 存储输出文件的目录<br>    path: path.join(__dirname, &#x27;dist&#x27;),<br>    // 打包文件的公共路径（由浏览器用于加载资源）<br>    publicPath: &#x27;/dist/&#x27;,<br>    // 主要包的输出文件名<br>    filename: &quot;bundle.js&quot;,<br>    // 动态加载的代码的输出文件名（代码分割）<br>    chunkFilename: &#x27;[name].js&#x27;<br>  &#125;,<br>  // 用于处理不同文件类型的模块配置<br>  module: &#123;<br>    // 使用Babel处理JavaScript和JSX文件的规则<br>    rules: [&#123;<br>      // 用于匹配以.jsx或.js结尾的文件<br>      test: /.jsx?$/,<br>      // 只处理src目录下的文件<br>      include: [<br>        path.resolve(__dirname, &#x27;src&#x27;)<br>      ],<br>      // 排除node_modules目录下的文件<br>      exclude: [<br>        path.resolve(__dirname, &#x27;node_modules&#x27;)<br>      ],<br>      // 使用babel-loader进行转译<br>      loader: &#x27;babel-loader&#x27;,<br>      options: &#123;<br>        // 使用指定的Babel预设<br>        presets: [<br>          [&quot;@babel/env&quot;, &#123;<br>            // 指定目标浏览器版本为最近的两个Chrome版本<br>            &quot;targets&quot;: &#123;<br>              &quot;browsers&quot;: &quot;last 2 chrome versions&quot;<br>            &#125;<br>          &#125;]<br>        ]<br>      &#125;<br>    &#125;]<br>  &#125;,<br>  // 配置模块解析的文件扩展名<br>  resolve: &#123;<br>    extensions: [&#x27;.json&#x27;, &#x27;.js&#x27;, &#x27;.jsx&#x27;]<br>  &#125;,<br>  // 生成源映射以方便调试<br>  devtool: &#x27;source-map&#x27;,<br>  // 配置开发服务器<br>  devServer: &#123;<br>    // 提供内容的基本目录<br>    contentBase: path.join(__dirname, &#x27;/dist/&#x27;),<br>    // 启用内联模式，自动注入脚本以处理实时更新<br>    inline: true,<br>    // 服务器主机<br>    host: &#x27;localhost&#x27;,<br>    // 服务器端口<br>    port: 8080,<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">JS配置文件运行在node环境中，所以需要使用CommonJS写法</font></p>
<p><font style="color:rgb(53, 53, 53);">插件还会自动安装这些插件：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;devDependencies&quot;: &#123;<br>  &quot;webpack&quot;: &quot;^5.74.0&quot;,<br>  &quot;webpack-cli&quot;: &quot;^4.10.0&quot;,<br>  &quot;@babel/core&quot;: &quot;^7.18.13&quot;,<br>  &quot;@babel/preset-env&quot;: &quot;^7.18.10&quot;,<br>  &quot;babel-loader&quot;: &quot;^8.2.5&quot;,<br>  &quot;webpack-dev-server&quot;: &quot;^4.10.0&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="GATLr">基本概念</h2>

<ol>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;entry&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: webpack打包的入口起点，从这里开始根据各个文件之间的依赖来对文件进行打包。单页面应用只有一个入口起点，多页面应用则存在多个入口起点</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;output&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 打包文件输出定义的地方，定义打包后输出文件的名字以及输出路径等</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 模式，webpack打包的模式，分为三种 development、production、none</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;loader&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 对javascript等文件进行预处理的，可以通过loader来构建包含javascript在内的任何静态资源</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;plugin&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 插件是用来解决loader解决不了的问题，它可以在webpack构建过程中任何一个节点来调用</font></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://createapp.dev/webpack/"><font style="color:rgb(53, 53, 53);">createapp.dev</font></a><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">是一个创建自定义 webpack 配置的在线工具</font></p>
<p><font style="color:rgb(53, 53, 53);">使用不同的配置文件：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;scripts&quot;: &#123;<br>  &quot;build&quot;: &quot;webpack --config prod.config.js&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="oPcrk">入口和上下文</h1>

<p><font style="color:rgb(53, 53, 53);">入口对象是用于 webpack 查找开始构建 bundle 的地方。上下文是入口文件所处的目录的绝对路径的字符串。</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/entry-context/"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<h2 id="Gw0xq">基础目录context</h2>

<p><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;context&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> 基础目录，</font><strong><font style="color:rgb(53, 53, 53);">绝对路径</font></strong><font style="color:rgb(53, 53, 53);">，解析入口点(entry point)和加载器(loader)</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">context: path.resolve(__dirname, &#x27;src&#x27;),<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">配置了context后，entry路径相对于context</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">entry: &#x27;./src/index.js&#x27;,<br>// 配置context后<br>context: path.resolve(__dirname, &#x27;src&#x27;),<br>entry: &#x27;./index.js&#x27;,<br></code></pre></td></tr></table></figure>

<h2 id="G263V">入口entry</h2>

<p><font style="color:rgb(53, 53, 53);">entry指示webpack使用一个或多个模块，来作为构建应用的入口，webpack会找出哪些模块和是入口起点的直接或者间接的依赖，并将其打包到一起。默认值</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;./src/index.js&lt;/font&gt;</code></p>
<p><strong><font style="color:rgb(53, 53, 53);">value类型：</font></strong><font style="color:rgb(53, 53, 53);">string、array、object</font></p>
<p><font style="color:rgb(53, 53, 53);">入口分为</font><strong><font style="color:rgb(53, 53, 53);">单入口</font></strong><font style="color:rgb(53, 53, 53);">(单页应用SPA)和</font><strong><font style="color:rgb(53, 53, 53);">多入口</font></strong><font style="color:rgb(53, 53, 53);">(多页面应用)</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">1、单入口</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">单入口主要使用string、array为值，应用于单页应用SPA</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">entry: &#x27;./index.js&#x27;,<br>// 将这两个文件以及其中所依赖的代码打包到同一个文件中<br>entry: [&#x27;./index.js&#x27;, &#x27;./main.js&#x27;],<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">这种写法默认的chunkname是main，是object的简略写法</font></p>
<p>object完整写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">entry: &#123;<br>  main: &#x27;./index.js&#x27;,<br>&#125;,<br>entry: &#123;<br>  main: [&#x27;./index.js&#x27;, &#x27;./main.js&#x27;],<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(53, 53, 53);">2、多入口</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">多入口即有多个html，分别需要不同的打包好的js</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  entry: &#123;<br>    main: &#x27;./src/main.js&#x27;,<br>    bundle: &#x27;./src/index.js&#x27;<br>  &#125;,<br>  // 这里的[name]相当于是个占位符，值就是上面入口的key值，单入口时可以写死，不过不建议<br>  output: &#123;<br>    // 多入口需要对应多出口，通常用[name]占位，不然打包会报错<br>    filename: &#x27;[name].js&#x27;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">可以看到dist目录下打包好了 main.js 和 index.js 两个文件</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">3、更多配置</font></strong><font style="color:rgb(53, 53, 53);"><br></font><font style="color:rgb(53, 53, 53);">打包入口不仅仅是写一个入口文件地址就可以，它还有额外的配置：</font></p>
<ol>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;dependOn&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 指当前入口文件所依赖的模块，这些模块必须在入口文件被加载前加载</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;filename&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 指定要输出的文件名称(优先级高于output中的filename和path)</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;import&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">: 启动时要加载的模块(入口文件地址)</font></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  entry: &#123;<br>    index: &#x27;./index.js&#x27;,<br>    main: &#x27;./main.js&#x27;,<br>    catalog: &#123;<br>      import: &#x27;./catalog.js&#x27;,<br>      filename: &#x27;pages/log.js&#x27;,<br>      dependOn: &#x27;main&#x27;,<br>    &#125;,<br>  &#125;,<br>  output: &#123;<br>    filename: &#x27;[name].js&#x27;,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="LjQ58">出口output</h2>

<p><font style="color:rgb(53, 53, 53);">output配置的作用是告知webpack如何向硬盘写入打包好的文件。</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">注意：</font></strong><font style="color:rgb(53, 53, 53);">entry可以存在多个入口，但output只有一个出口配置</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">配置项：</font></strong></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">filename 打包文件名，默认main.js</font></li>
<li><font style="color:rgb(53, 53, 53);">path 打包文件输出路径，默认dist</font></li>
<li><font style="color:rgb(53, 53, 53);">clean 输出包前清空输出目录，默认false</font></li>
</ol>
<p><strong><font style="color:rgb(53, 53, 53);">1、filename</font></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain">// [name]对应entry的key<br>output: &#123;<br>  filename: &#x27;[name].js&#x27;,<br>&#125;<br>// 使用内部chunk id占位<br>output: &#123;<br>  filename: &#x27;[id].bundle.js&#x27;,<br>  // main-0.js<br>&#125;,<br>// 使用由生成的内容产生的 hash，通常和[name]组合使用<br>output: &#123;<br>  filename: &#x27;[name]-[contenthash].js&#x27;,<br>  // main-8bc05850732530fe321c.js<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(53, 53, 53);">2、path 和 clean</font></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">output: &#123;<br>  path: path.resolve(__dirname, &#x27;dist&#x27;),<br>  filename: &#x27;[name]-[contenthash].js&#x27;,<br>  clean: true,<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="pVq9O">工作模式mode</h1>

<p><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> 用于设置webpack的工作模式，告知 webpack 使用相应模式的内置优化</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  mode: &#x27;development&#x27;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">三种工作模式：</font></p>
<ol>
<li><strong><font style="color:rgb(53, 53, 53);">production</font></strong><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">默认，生产模式，启用自动压缩代码、去除业务无关代码等</font></li>
<li><strong><font style="color:rgb(53, 53, 53);">development</font></strong><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">开发模式</font></li>
<li><strong><font style="color:rgb(53, 53, 53);">none</font></strong><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">不使用任何默认优化选项</font></li>
</ol>
<h1 id="yAZpM">打包结果分析</h1>

<p><font style="color:rgb(53, 53, 53);">将 mode 设为 none，查看输出文件</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs plain">/******/ (() =&gt; &#123; // webpackBootstrap<br>/******/ 	&quot;use strict&quot;;<br>/******/ 	var __webpack_modules__ = ([<br>/******/ 	]);<br>/************************************************************************/<br>/******/ 	// The module cache<br>/******/ 	var __webpack_module_cache__ = &#123;&#125;;<br>/******/ 	<br>/******/ 	// The require function<br>/******/ 	function __webpack_require__(moduleId) &#123;<br>/******/ 	&#125;<br>/******/ 	<br>/************************************************************************/<br>/******/ 	/* webpack/runtime/define property getters */<br>/******/ 	(() =&gt; &#123;<br>/******/ 	&#125;)();<br>/******/ 	<br>/******/ 	/* webpack/runtime/hasOwnProperty shorthand */<br>/******/ 	(() =&gt; &#123;<br>/******/ 	&#125;)();<br>/******/ 	<br>/******/ 	/* webpack/runtime/make namespace object */<br>/******/ 	(() =&gt; &#123;<br>/******/ 	&#125;)();<br>/******/ 	<br>/************************************************************************/<br>var __webpack_exports__ = &#123;&#125;;<br>// This entry need to be wrapped in an IIFE because it need to be isolated against other entry modules.<br>(() =&gt; &#123;<br>&#125;)();<br><br>// This entry need to be wrapped in an IIFE because it need to be isolated against other entry modules.<br>(() =&gt; &#123;<br>&#125;)();<br><br>/******/ &#125;)()<br>;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">先看最末尾的两个IIFE，两个入口文件 index.js 和 main.js，分别被打包为了立即执行函数，以此实现私有作用域</font></p>
<h1 id="WlqMk">loader</h1>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/loaders/"><font style="color:rgb(53, 53, 53);">loader</font></a><font style="color:rgb(53, 53, 53);">是webpack实现前端模块化的核心，用于将指定格式的资源文件按一定格式进行转换输出</font></p>
<p><font style="color:rgb(53, 53, 53);">例如，可以使用 loader 告诉 webpack 加载 CSS 文件，或者将 TypeScript 转为 JavaScript。</font></p>
<p><font style="color:rgb(53, 53, 53);">官方:</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/"><font style="color:#117CEE;">Loaders | webpack 中文文档</font></a></p>
<p><strong><font style="color:rgb(53, 53, 53);">特点：</font></strong></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">单一职责：一个Loader只做一件事情，正因为职责越单一，所以Loaders的组合性强，可配置性好</font></li>
<li><font style="color:rgb(53, 53, 53);">loader支持链式调用，上一个loader的处理结果可以传给下一个loader接着处理，上一个Loader的参数options可以传递给下一个loader，直到最后一个loader，返回Webpack所期望的JavaScript</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">webpack内部的default loader只能处理JavaScript，想要处理如css、ts等其它类型文件，就要安装对应的loader</font></p>
<p><font style="color:rgb(53, 53, 53);">loader可以分为三类：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">编译转换型：如css-loader</font></li>
<li><font style="color:rgb(53, 53, 53);">文件操作型：如file-loader</font></li>
<li><font style="color:rgb(53, 53, 53);">代码检查型：如eslint-loader</font></li>
</ol>
<p><strong><font style="color:rgb(53, 53, 53);">案例：</font></strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 用于处理不同文件类型的模块配置</span><br><span class="hljs-attr">module</span>: &#123;<br>  <span class="hljs-comment">// 使用Babel处理JavaScript和JSX文件的规则</span><br>  <span class="hljs-attr">rules</span>: [&#123;<br>    <span class="hljs-comment">// 用于匹配以.jsx或.js结尾的文件</span><br>    <span class="hljs-attr">test</span>: <span class="hljs-regexp">/.jsx?$/</span>,<br>    <span class="hljs-comment">// 只处理src目录下的文件</span><br>    <span class="hljs-attr">include</span>: [<br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;src&#x27;</span>)<br>    ],<br>    <span class="hljs-comment">// 排除node_modules目录下的文件</span><br>    <span class="hljs-attr">exclude</span>: [<br>      path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;node_modules&#x27;</span>)<br>    ],<br>    <span class="hljs-comment">// 使用babel-loader进行转译</span><br>    <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>    <span class="hljs-attr">options</span>: &#123;<br>      <span class="hljs-comment">// 使用指定的Babel预设</span><br>      <span class="hljs-attr">presets</span>: [<br>        [<span class="hljs-string">&quot;@babel/env&quot;</span>, &#123;<br>          <span class="hljs-comment">// 指定目标浏览器版本为最近的两个Chrome版本</span><br>          <span class="hljs-string">&quot;targets&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;browsers&quot;</span>: <span class="hljs-string">&quot;last 2 chrome versions&quot;</span><br>          &#125;<br>        &#125;]<br>      ]<br>    &#125;<br>  &#125;]<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">Module的文档：</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/module/"><font style="color:#117CEE;">Module | webpack 中文文档</font></a></p>
<h2 id="ijkvD">加载css</h2>

<p><font style="color:rgb(53, 53, 53);">查看官方文档</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/asset-management/#loading-css"><font style="color:rgb(53, 53, 53);">指南-管理资源-加载CSS</font></a></p>
<p><font style="color:rgb(53, 53, 53);">安装所需的loader</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm install --save-dev style-loader css-loader<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">添加配置，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/css-loader/"><font style="color:rgb(53, 53, 53);">css-loader</font></a><font style="color:rgb(53, 53, 53);">将css文件打包为js模块，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/style-loader/"><font style="color:rgb(53, 53, 53);">style-loader</font></a><font style="color:rgb(53, 53, 53);">把 CSS 插入到 DOM 中（css-loader将css push到一个数组中，style-loader将数组中的css通过style标签追加到html-head中）</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  module: &#123;<br>    rules: [<br>      &#123;<br>        // 正则匹配loader要处理的资源<br>        test: /\.css$/i,<br>        // 逆序执行，从右往左<br>        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">src目录下创建index.css,打包入口中使用该css</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#x27;./index.css&#x27;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">现在样式已经生效</font></p>
<p><font style="color:rgb(53, 53, 53);">webpack推荐我们使用import根据JS代码的需要</font><strong><font style="color:rgb(53, 53, 53);">动态</font></strong><font style="color:rgb(53, 53, 53);">导入资源，就像刚刚import css一样，这样的代码与资源的关系，更符合模块化的依赖思想</font></p>
<h2 id="ampB3">加载其它资源</h2>

<p><font style="color:rgb(53, 53, 53);">webpack5使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/asset-modules/"><font style="color:#117CEE;">资源模块Asset Modules</font></a><font style="color:rgb(53, 53, 53);">来加载图片、字体等资源，webpack4则使用</font><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/loaders/file-loader/"><font style="color:rgb(53, 53, 53);">file-loader</font></a><font style="color:rgb(53, 53, 53);">和</font><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/loaders/url-loader/"><font style="color:rgb(53, 53, 53);">url-loader</font></a><font style="color:rgb(53, 53, 53);">等</font></p>
<h3 id="OBn90">file-loader</h3>

<p><font style="color:rgb(53, 53, 53);">安装</font><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/loaders/file-loader/"><font style="color:#117CEE;">file-loader</font></a><font style="color:rgb(53, 53, 53);">：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm i file-loader -D<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">import avatar from &#x27;./avatar.png&#x27; // 导入打包后资源的路径<br>const img = new Image();<br>img.src = avatar;<br>document.body.append(img);<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">配置规则</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">module: &#123;<br>  rules: [<br>    /******/<br>    &#123;<br>      test: /\.png$/,<br>      use: &#x27;file-loader&#x27;,<br>    &#125;<br>  ],<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">打包后，在dist目录下生成了871132b331c17257fcba75273b57f9fe.png，这是将文件的hash值作为了打包后的文件名，当然，这也是可以自定义的。</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.png$/,<br>  use: &#123;<br>    loader: &#x27;file-loader&#x27;,<br>    options: &#123;<br>      // 默认[hash].[ext]<br>      name: &#x27;[path][name].[ext]&#x27;,<br>    &#125;<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">这样就能保留图片的原始相对路径和名称。</font></p>
<h3 id="vK2Dh">url-loader</h3>

<p><font style="color:rgb(53, 53, 53);">file-loader拷贝文件到输出目录，而</font><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/loaders/url-loader/"><font style="color:rgb(53, 53, 53);">url-loader</font></a><font style="color:rgb(53, 53, 53);">通过</font><strong><font style="color:rgb(53, 53, 53);">durl</font></strong><font style="color:rgb(53, 53, 53);">的形式表示文件</font></p>
<p><strong>shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm i url-loader -D<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">durl即Data URLs，可以通过url直接去表示文件的内容，不会产生任何请求</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">// 一个html类型的文件内容，编码是utf-8<br>data:text/html;charset=UTF-8,&lt;h1&gt;html content&lt;/h1&gt;<br>// 如果是图片这种无法直接通过文本表示的文件，则可以将文件内容进行base64编码<br>data:image/png;base64,iDAHAidhbaIADHA...AHiDAd<br></code></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(53, 53, 53);">最佳实践：</font></strong><font style="color:rgb(53, 53, 53);">配置小文件使用url-loader，大文件则使用file-loader</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.(png|ico)$/,<br>  use: &#123;<br>    loader: &quot;url-loader&quot;,<br>    options: &#123;<br>      name: &quot;[path][name]_[hash:6].[ext]&quot;,<br>      limit: 50 * 1024, //小于50kb的进行编码<br>      // 超过这个大小，url-loader会自动调用file-loader<br>    &#125;,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; createImage &#125; from &quot;./module.js&quot;;<br>import avatar from &#x27;./avatar.png&#x27;<br>import icon from &#x27;./icon.ico&#x27;<br>document.body.append(createImage(avatar));<br>document.body.append(createImage(icon));<br></code></pre></td></tr></table></figure>

<h3 id="mggbT">Asset Modules</h3>

<p><font style="color:rgb(53, 53, 53);">webpack5使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/asset-modules/"><font style="color:#117CEE;">资源模块Asset Modules</font></a><font style="color:rgb(53, 53, 53);">来加载图片、字体等资源。</font></p>
<p><font style="color:rgb(53, 53, 53);">在webpack5之前，通常使用：raw-loader将文件导入为字符串，url-loader将文件作为durl内联到bundle中，file-loader将文件发送到输出目录</font></p>
<p><font style="color:rgb(53, 53, 53);">资源模块类型(asset module type)，通过添加 4 种新的模块类型，来替换所有这些 loader：</font></p>
<ol>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;asset/resource&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">发送一个单独的文件并导出 URL。之前通过使用 file-loader 实现。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;asset/inline&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">导出一个资源的 data URI。之前通过使用 url-loader 实现。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;asset/source&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">导出资源的源代码。之前通过使用 raw-loader 实现。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;asset&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">在导出一个 data URI 和发送一个单独的文件之间自动选择。之前通过使用 url-loader，并且配置资源体积限制实现。</font></li>
</ol>
<p><strong><font style="color:rgb(53, 53, 53);">案例：</font></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.(png|jpg|svg|gif|ico)$/,<br>  // type选择类型<br>  type: &quot;asset/resource&quot;,<br>  // 通过generator属性进行配置<br>  generator: &#123;<br>    filename: &quot;img/[name]_[hash:6][ext]&quot;,<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">asset/inline&#123;<br>  test: /\.(png|jpg|svg|gif|ico)$/,<br>  type: &quot;asset/inline&quot;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">最佳实践：type设为asset，添加一个parser属性，并且制定dataUrl的条件，添加maxSize属性；</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.(png|jpg|svg|gif|ico)$/,<br>  type: &quot;asset&quot;,<br>  generator: &#123;<br>    filename: &quot;img/[name]_[hash:6][ext]&quot;,<br>  &#125;,<br>  parser: &#123;<br>    dataUrlCondition: &#123;<br>      maxSize: 50 * 1024,//小于50kb进行编码，转为base64<br>    &#125;,<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<h2 id="jcGSI">babel-loader</h2>

<p><font style="color:rgb(53, 53, 53);">webpack由于打包需要，会去处理import和export，但对于其它ES6新特性，则不会去做兼容处理</font></p>
<p><font style="color:rgb(53, 53, 53);">如果需要将代码中的ES6进行转换，则需要</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/babel-loader/"><font style="color:rgb(53, 53, 53);">babel-loader</font></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">// 安装babel-loader及其依赖的核心库和特性转换集合<br>npm install -D babel-loader @babel/core @babel/preset-env<br></code></pre></td></tr></table></figure>

<p><strong><font style="color:rgb(53, 53, 53);">注意：</font></strong><font style="color:rgb(53, 53, 53);">babel只是转换JS代码的一个平台，还需要用其它的插件，如@babel&#x2F;preset-env，通过该平台来转换ES6特性</font></p>
<p><font style="color:rgb(53, 53, 53);">进行配置：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">module: &#123;<br>  rules: [<br>    &#123;<br>      test: /\.js$/i,<br>      include: [<br>        path.resolve(__dirname, &#x27;src&#x27;)<br>      ],<br>      exclude: [<br>        path.resolve(__dirname, &#x27;node_modules&#x27;)<br>      ],<br>      loader: &#x27;babel-loader&#x27;,<br>      options: &#123;<br>        presets: [&quot;@babel/preset-env&quot;]<br>      &#125;<br>    &#125;,<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">开启ESM转CommonJS(会导致Tree Shaking失效，不推荐开启)</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">presets: [<br>  [&quot;@babel/preset-env&quot;, &#123;<br>    modules: &quot;commonjs&quot;, // 开启ESM转CommonJS，默认：&quot;auto&quot;<br>  &#125;]<br>]<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">这样就完成了简单的ES6转换，更完善的使用core-js@3兼容，后面再说吧。</font></p>
<h2 id="Pmsfh">资源加载方式</h2>

<p><font style="color:rgb(53, 53, 53);">除了在js文件中使用import加载资源，webpack还会自动处理其它加载资源的方式，如css文件中的url()、@import</font></p>
<p><font style="color:rgb(53, 53, 53);">例如：当css-loader在处理css文件时遇到url()时，会找到符合的规则对所需的资源进行处理，如使用asset&#x2F;resource对图片资源处理</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">/* main.css */<br>body&#123;<br>  background-image: url(avatar.png);<br>  background-size: auto;<br>&#125;<br><br>/* index.css */<br>@import &#x27;./main.css&#x27;;<br>body&#123;<br>  background-color: #ccc;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="zM3TD">开发loader</h2>

<p><font style="color:rgb(53, 53, 53);">尝试开发一个markdown-loader，深入了解loader的工作过程</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">文档：</font></strong><a target="_blank" rel="noopener" href="https://www.webpackjs.com/contribute/writing-a-loader/"><font style="color:rgb(53, 53, 53);">编写loader</font></a></p>
<p><strong><font style="color:rgb(53, 53, 53);">功能：</font></strong><font style="color:rgb(53, 53, 53);">将模块中所需的markdown资源转为html内容导入</font></p>
<p><font style="color:rgb(53, 53, 53);">在根目录新建</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;markdown-loader.js&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">，一个最简单的loader是一个函数，接收传入的资源内容，若该loader是最后一个执行的，返回结果必须是JS代码</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = source =&gt; &#123;<br>  console.log(source)<br>  return &#x27;console.log(source)&#x27;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">使用该loader</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.md$/i,<br>  use: path.resolve(__dirname, &#x27;markdown-loader.js&#x27;),<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">在模块中导入markdown，webpack只会处理模块所依赖的资源</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">import md from &#x27;./01.md&#x27;<br>console.log(md)<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">打包时控制台输出了markdown的内容。查看打包结果，loader返回的js也在其中，被一个IIFE包裹。</font></p>
<p><font style="color:rgb(53, 53, 53);">下面继续完成功能：</font></p>
<p><font style="color:rgb(53, 53, 53);">安装解析markdown内容的模块，使用</font><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/marked"><font style="color:rgb(53, 53, 53);">marked</font></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">npm i marked -D<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">修改 </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;markdown-loader.js&lt;/font&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">const marked = require(&#x27;marked&#x27;);<br><br>module.exports = source =&gt; &#123;<br>  console.log(source)<br>  const html = marked.parse(source)<br>  console.log(html)<br>  return &#x27;console.log(source)&#x27;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">输出如下，现在loader已经能解析markdown文件了</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain"># 简介<br>这是一个**markdown**<br>&lt;h1&gt;简介&lt;/h1&gt;<br>&lt;p&gt;这是一个&lt;strong&gt;markdown&lt;/strong&gt;&lt;/p&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">完善loader，将html暴露给模块使用，会作为模块中import markdown文件的default值</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">const marked = require(&#x27;marked&#x27;);<br><br>module.exports = source =&gt; &#123;<br>  const html = marked.parse(source)<br>  // html中存在一些字符，使用JSON.stringify进行转译<br>  return `export default $&#123;JSON.stringify(html)&#125;`<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">现在，markdown-loader就完成了，模块导入的就是解析好的html内容</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">import md from &#x27;./01.md&#x27;<br>console.log(md)<br>// &lt;h1&gt;简介&lt;/h1&gt;<br>// &lt;p&gt;这是一个&lt;strong&gt;markdown&lt;/strong&gt;&lt;/p&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">当然，markdown-loader也可以直接返回解析好的html内容，再交给loader管道中下一个loader进行处理，webpack只要求最后一个loader返回的需要是JS代码</font></p>
<p><font style="color:rgb(53, 53, 53);">处理html就需要安装html-loader，</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i html-loader -D&lt;/font&gt;</code></p>
<p><font style="color:rgb(53, 53, 53);">修改代码：</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  test: /\.md$/i,<br>  use: [<br>    &#x27;html-loader&#x27;,<br>    path.resolve(__dirname, &#x27;markdown-loader.js&#x27;),<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">const marked = require(&#x27;marked&#x27;);<br><br>module.exports = source =&gt; &#123;<br>  const html = marked.parse(source)<br>  return html<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">实现的功能也是一样的</font></p>
<h1 id="BCeWv">plugin</h1>

<p><font style="color:rgb(53, 53, 53);">loader用于处理资源的加载，而插件</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/plugins/"><font style="color:rgb(53, 53, 53);">plugin</font></a><font style="color:rgb(53, 53, 53);">用于实现各种</font><strong><font style="color:rgb(53, 53, 53);">自动化</font></strong><font style="color:rgb(53, 53, 53);">操作，如压缩代码、替换内容、处理资源</font></p>
<p><font style="color:rgb(53, 53, 53);">官方</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/"><font style="color:rgb(53, 53, 53);">plugins</font></a></p>
<h2 id="RQuMG">打包分析插件</h2>

<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/webpack-bundle-analyzer"><font style="color:rgb(53, 53, 53);">webpack-bundle-analyzer</font></a><font style="color:rgb(53, 53, 53);">是一个打包分析插件，使用交互式可缩放树形地图可视化，并输出文件的大小。可以方便开发人员检查打包后的文件拆分、分析文件大小。</font></p>
<p><font style="color:rgb(53, 53, 53);">每次打包时，会自动打开浏览器，访问</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;127.0.0.1:8888&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">查看项目结构</font></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i webpack-bundle-analyzer -D&lt;/font&gt;</code></p>
<p><font style="color:rgb(53, 53, 53);">webpack中，插件都需要导入后使用，且通常插件导出的都是一个class，需要new实例。配置项plugins是一个数组，保存插件的实例。</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">const &#123; BundleAnalyzerPlugin &#125; = require(&#x27;webpack-bundle-analyzer&#x27;);<br>/*****/<br>plugins: [<br>  new BundleAnalyzerPlugin(),<br>],<br></code></pre></td></tr></table></figure>

<h2 id="RKMW1">自动生成HTML</h2>

<p><font style="color:rgb(53, 53, 53);">手动在根目录创建index.html，并配置打包好的JS等资源的路径，这样硬编码过于麻烦且易出错</font></p>
<p><font style="color:rgb(53, 53, 53);">可以使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/html-webpack-plugin/"><font style="color:rgb(53, 53, 53);">html-webpack-plugin</font></a><font style="color:rgb(53, 53, 53);">简化HTML文件的创建，自动引入打包好的JS模块，这对于那些文件名中包含哈希值，并且哈希值会随着每次编译而改变的 webpack 包特别有用。</font></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i html-webpack-plugin --D&lt;/font&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)<br>plugins: [<br>  new HtmlWebpackPlugin(&#123;<br>    template: path.resolve(__dirname, &#x27;./index.html&#x27;), // 自定义模板<br>    inject: &#x27;body&#x27;, // 插入到body<br>    filename: &#x27;index.html&#x27;, // 输出文件名，默认index.html<br>    title: &#x27;webpack测试&#x27;, // 自定义title，通过&lt;%= htmlWebpackPlugin.options.title %&gt;在html中使用<br>    minify: true, // 压缩<br>  &#125;),<br>]<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">修改根目录下的index.html，使其作为一个模板</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>  &lt;meta charset=&quot;UTF-8&quot;&gt;<br>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>  &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>  &lt;!-- 去掉js文件的引入，插件会自动引入 --&gt;<br>  &lt;!-- &lt;script src=&quot;dist/main.js&quot;&gt;&lt;/script&gt; --&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">查看打包后的index.html</font></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;en&quot;&gt;<br>&lt;head&gt;<br>  &lt;meta charset=&quot;UTF-8&quot;&gt;<br>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br>  &lt;title&gt;webpack测试&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>  &lt;script defer src=&quot;main_0cc0be.js&quot;&gt;&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">html-webpack-plugin还有其它的配置项，查看官方仓库文档：</font><a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin#options"><font style="color:rgb(53, 53, 53);">配置项</font></a></p>
<p><font style="color:rgb(53, 53, 53);">若是多页面、多个html文件，则创建多个插件实例加入到plugins数组中</font></p>
<h2 id="JC5om">拷贝文件</h2>

<p><font style="color:rgb(53, 53, 53);">通常项目中还有一些无需打包的静态文件存放于public目录，这些资源同样需要输出到dist</font></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/copy-webpack-plugin/"><font style="color:rgb(53, 53, 53);">copy-webpack-plugin</font></a></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i copy-webpack-plugin -D&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">const CopyPlugin = require(&quot;copy-webpack-plugin&quot;);<br>plugins: [<br>  new CopyPlugin(&#123;<br>    patterns: [<br>      // 复制public文件夹内的文件到&#123;output&#125;中<br>      &#123; from: path.resolve(__dirname, &#x27;public&#x27;), to: &quot;&quot; &#125;,<br>    ],<br>  &#125;),<br>]<br></code></pre></td></tr></table></figure>

<h2 id="KjyCM">开发plugin</h2>

<p><font style="color:rgb(53, 53, 53);">相较于loader只作用于模块加载，plugin的作用范围更广。plugin通过常见的</font><strong><font style="color:rgb(53, 53, 53);">钩子机制</font></strong><font style="color:rgb(53, 53, 53);">实现，就像Vue生命周期提供的钩子一样。</font></p>
<p><font style="color:rgb(53, 53, 53);">webpack提供了很多打包过程中的</font><strong><font style="color:rgb(53, 53, 53);">钩子</font></strong><font style="color:rgb(53, 53, 53);">，plugin向这些钩子上</font><strong><font style="color:rgb(53, 53, 53);">挂载</font></strong><font style="color:rgb(53, 53, 53);">任务，并获取</font><strong><font style="color:rgb(53, 53, 53);">上下文</font></strong><font style="color:rgb(53, 53, 53);">，来实现对资源的操作等功能。</font></p>
<p><font style="color:rgb(53, 53, 53);">钩子相关文档：</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compiler-hooks/"><font style="color:rgb(53, 53, 53);">compiler-hooks</font></a></p>
<p><font style="color:rgb(53, 53, 53);">webpack要求plugin必须是一个函数，或一个</font><strong><font style="color:rgb(53, 53, 53);">包含apply方法</font></strong><font style="color:rgb(53, 53, 53);">的对象，通常是定义一个包含apply方法的类</font></p>
<p><font style="color:rgb(53, 53, 53);">新建</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;myPlugin.js&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<p><font style="color:rgb(53, 53, 53);">现在开发一个用于清除webpack生成的</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;/******/&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">注释，以方便阅读打包后的JS代码</font></p>
<p><font style="color:rgb(53, 53, 53);">明确了功能，考虑需要用到哪些钩子，显然，清除注释要在输出文件前执行，对要输出的内容进行处理。</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/compiler-hooks/#emit"><font style="color:rgb(53, 53, 53);">emit</font></a><font style="color:rgb(53, 53, 53);">钩子符合需求，这个钩子在输出 asset 到 output 目录之前执行。</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">export default class &#123;<br>  // apply接收一个compiler对象参数<br>  // 这个对象包含了打包过程中所有信息以及用于注册钩子函数<br>  apply(compiler) &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">export default class &#123;<br>  // apply接收一个compiler对象参数<br>  // 这个对象包含了打包过程中所有信息以及用于注册钩子函数<br>  apply(compiler) &#123;<br>    // 通过hooks属性访问钩子，tap方法注册钩子函数<br>    // tap方法第一个参数为plugin名，第二个参数是接收了compilation对象的钩子函数<br>    compiler.hooks.emit.tap(&#x27;MyPlugin&#x27;, compilation =&gt; &#123;<br>      // compilation是此次打包过程中的上下文，存放了打包过程的信息和结果<br>      // compilation.assets获取即将输出的资源文件信息<br>      for (const name in compilation.assets) &#123;<br>        console.log(name); // 输出文件名<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">使用插件</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">const MyPlugin = require(&#x27;./myPlugin.js&#x27;);<br>plugins: [<br>  new MyPlugin(),<br>]<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">输出：</font></p>
<p><strong>shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">main_28990539038fea465479.js<br>img/avatar_871132b331c17257fcba.png<br>img/icon_36fa45932bf38a34e9af.ico<br>favicon.ico<br>index.html<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">插件已经能读取到打包后的文件名，接下来通过正则替换来处理JS文件</font></p>
<p><strong>js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">class</span> &#123;<br>  #<span class="hljs-title function_">isJSFile</span>(<span class="hljs-params">filename</span>) &#123;<br>    <span class="hljs-comment">// 使用正则表达式检查文件名是否以 .js 结尾</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-regexp">/\.js$/i</span>.<span class="hljs-title function_">test</span>(filename);<br>  &#125;<br><br>  <span class="hljs-comment">// apply接收一个compiler对象参数</span><br>  <span class="hljs-comment">// 这个对象包含了打包过程中所有信息以及用于注册钩子函数</span><br>  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) &#123;<br>    <span class="hljs-comment">// 通过hooks属性访问钩子，tap方法注册钩子函数</span><br>    <span class="hljs-comment">// tap方法第一个参数为plugin名，第二个参数是接收了compilation对象的钩子函数</span><br>    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">&#x27;MyPlugin&#x27;</span>, <span class="hljs-function"><span class="hljs-params">compilation</span> =&gt;</span> &#123;<br>      <span class="hljs-comment">// compilation是此次打包过程中的上下文，存放了打包过程的信息和结果</span><br>      <span class="hljs-comment">// compilation.assets获取即将输出的资源文件信息</span><br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">in</span> compilation.<span class="hljs-property">assets</span>) &#123;<br>        <span class="hljs-comment">// console.log(name);</span><br>        <span class="hljs-comment">// 使用source方法获取文件内容</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.#<span class="hljs-title function_">isJSFile</span>(name))&#123;<br>          <span class="hljs-keyword">let</span> content = compilation.<span class="hljs-property">assets</span>[name].<span class="hljs-title function_">source</span>();<br>          <span class="hljs-comment">// 使用正则去除webpack生成的/******/</span><br>          content = content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/\*&#123;3,&#125;\//g</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>          <span class="hljs-comment">// 覆盖文件信息</span><br>          compilation.<span class="hljs-property">assets</span>[name] = &#123;<br>            <span class="hljs-comment">// 覆盖内容</span><br>            <span class="hljs-attr">source</span>: <span class="hljs-function">() =&gt;</span> content,<br>            <span class="hljs-comment">// webpack要求指定大小</span><br>            <span class="hljs-attr">size</span>: <span class="hljs-function">() =&gt;</span> content.<span class="hljs-property">length</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">现在，打包的JS文件内容已经去除了</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;/******/&lt;/font&gt;</code></p>
<p><font style="color:rgb(53, 53, 53);">但控制台有警告信息：</font></p>
<p><strong>shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">(node:76292) [DEP_WEBPACK_COMPILATION_ASSETS] DeprecationWarning: Compilation.assets will be frozen in future, all modifications are deprecated.<br>BREAKING CHANGE: No more changes should happen to Compilation.assets after sealing the Compilation.<br>        Do changes to assets earlier, e. g. in Compilation.hooks.processAssets.<br>        Make sure to select an appropriate stage from Compilation.PROCESS_ASSETS_STAGE_*.<br>(Use `node --trace-deprecation ...` to show where the warning was created)<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">这是因为Webpack5将在未来版本冻结</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;compilation.assets&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">，需在</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;compiler.hooks.thisCompilation&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">钩子中使用 Compilation 中的 processAssets hook 来对资源进行再处理</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = class &#123;<br>  #isJSFile(filename) &#123;<br>    // 使用正则表达式检查文件名是否以 .js 结尾<br>    return /\.js$/i.test(filename);<br>  &#125;<br><br>  // apply接收一个compiler对象参数<br>  // 这个对象包含了打包过程中所有信息以及用于注册钩子函数<br>  apply(compiler) &#123;<br>    // 使用thisCompilation钩子，在 compilation 对象创建时执行一些自定义逻辑<br>    compiler.hooks.thisCompilation.tap(&#x27;MyPlugin&#x27;, compilation =&gt; &#123;<br>      // processAssets钩子用于在 webpack 编译完成后，但在最终资源输出之前，处理资源文件的阶段执行插件代码<br>      compilation.hooks.processAssets.tap(<br>        &#123;<br>          name: &#x27;MyPlugin&#x27;,<br>          // https://webpack.docschina.org/api/compilation-hooks/#list-of-asset-processing-stages<br>          stage: compilation.PROCESS_ASSETS_STAGE_OPTIMIZE, // 以通用的方式优化已有asset<br>        &#125;,<br>        (assets) =&gt; &#123;<br>          for (const name in assets) &#123;<br>            if (this.#isJSFile(name)) &#123;<br>              // 使用正则表达式去除块注释<br>              const content = assets[name].source().replace(/\/\*&#123;3,&#125;\//g, &#x27;&#x27;);<br>              // 覆盖文件信息<br>              assets[name] = &#123;<br>                source: () =&gt; content,<br>                size: () =&gt; content.length,<br>              &#125;;<br>            &#125;<br>          &#125;<br>        &#125;<br>      );<br>    &#125;)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="hyJBV">优化开发过程</h1>

<p><font style="color:rgb(53, 53, 53);">项目打包过程已经自动化了，但开发过程仍然在手动操作</font></p>
<p><font style="color:rgb(53, 53, 53);">编写代码-&gt;命令打包-&gt;运行应用-&gt;刷新浏览器，这个繁琐的过程也需要自动化，以提高开发效率</font></p>
<p><font style="color:rgb(53, 53, 53);">提出下面的需求：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">以 HTTP Server 运行，而不是打开文件浏览</font></li>
<li><font style="color:rgb(53, 53, 53);">自动编译 + 自动刷新</font></li>
<li><font style="color:rgb(53, 53, 53);">提供 Source Map 支持，方便调试</font></li>
</ol>
<h2 id="SwxYz">watch工作模式</h2>

<p><font style="color:rgb(53, 53, 53);">处于watch工作模式时，webpack会监听文件变化，自动重新打包</font></p>
<p><font style="color:rgb(53, 53, 53);">添加watch配置：</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  watch: true,<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="MMMYw">DevServer</h2>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server"><font style="color:rgb(53, 53, 53);">webpack dev server</font></a><font style="color:rgb(53, 53, 53);">提供了HTTP Server，集成了自动编译和自动刷新浏览器的功能。</font></p>
<p><font style="color:rgb(53, 53, 53);">该插件会将将打包结果暂时存放于内存，而不输出于硬盘，以提高性能。</font></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i webpack-dev-server -D&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<p>添加配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  // 配置开发服务器<br>  devServer: &#123;<br>    // 服务器主机<br>    host: &#x27;localhost&#x27;,<br>    // 服务器端口<br>    port: 8080,<br>    // 启用Gzip<br>    compress: true,<br>    // CopyPlugin通常只在项目上线时去使用，开发时通常将静态资源目录配置给devServer，以提高性能<br>     // 使用static配置从目录提供静态文件的选项，默认public<br>    static: &#123;<br>      // 告诉服务器从哪里提供内容<br>      directory: path.join(__dirname, &#x27;public&#x27;),<br>    &#125;,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">添加命令脚本</font></p>
<p><strong>json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;scripts&quot;: &#123;<br>    &quot;serve&quot;: &quot;webpack serve&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">使用命令运行</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm run serve&lt;/font&gt;</code></p>
<h2 id="d1fjn">代理API服务</h2>

<p><font style="color:rgb(53, 53, 53);">前后端同源部署时，本地开发在请求api时可能有cors问题，可以使用开发服务器代理api请求，服务器间通信就不存在cors了</font></p>
<p><font style="color:rgb(53, 53, 53);">DevServer就支持</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;proxy&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">配置api代理，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/#devserverproxy"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain">devServer: &#123;<br>  proxy: &#123;<br>    // 代理api路径<br>    &#x27;/api&#x27;: &#123;<br>      // localhost:8080/api/user -&gt; api.github.com/api/user<br>      target: &#x27;https://api.github.com&#x27;,<br>      // 请求路径重写 /api/user -&gt; /user<br>      pathRewrite: &#123; &#x27;^/api&#x27;: &#x27;&#x27; &#125;,<br>      // 将 host 请求头修改为 target 的 URL<br>      changeOrigin: true,<br>    &#125;,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="nI3ag">Source Map</h2>

<p><font style="color:rgb(53, 53, 53);">前端工程化后，源代码和运行代码几乎完全不同，调试和报错都是基于运行代码，调试源代码就成了问题</font></p>
<p><font style="color:rgb(53, 53, 53);">Source Map用于映射源代码和运行代码之间的关系</font></p>
<p><font style="color:rgb(53, 53, 53);">一个Source Map的组成：</font></p>
<p><strong>json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;version&quot;: 3, // 当前Map使用的Source Map标准版本<br>  &quot;sources&quot;: [&quot;main.js&quot;], // 记录源文件的名称，可以是多个文件<br>  &quot;names&quot;: [&quot;global&quot;,/****/], // 源代码使用的成员名称，如变量的原名<br>  &quot;mappings&quot;: &quot;;/****/&quot; // 核心，记录源码和运行代码一些字符的映射关系<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">通过一行特定格式的注释引入Source Map</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">//# sourceMappingURL=main.map<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">如果Source Map不起作用，需在浏览器控制台-设置-偏好设置中启用JavaScript源代映射</font></p>
<p><font style="color:rgb(53, 53, 53);">使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/devtool/"><font style="color:rgb(53, 53, 53);">Devtool</font></a><font style="color:rgb(53, 53, 53);">在webpack中配置Source Map：</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  devtool: &#x27;source-map&#x27;, // 值为Source Map工作模式<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">相关文章：</font><a target="_blank" rel="noopener" href="https://juejin.cn/post/6960941899616092167"><font style="color:rgb(53, 53, 53);">一文搞懂SourceMap以及webpack devtool</font></a></p>
<p><font style="color:rgb(53, 53, 53);">Source Map工作模式：</font></p>
<p><strong>text</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map<br></code></pre></td></tr></table></figure>

<ol>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;inline-&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> 将SourceMap内联到原始文件中，而不是创建一个单独的文件。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;hidden-&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">仍然会生成.map文件，但是打包后的代码中没有sourceMappingURL，即浏览器不会加载.map文件，控制台中看不到源代码。Map生成后只供服务端分析使用，前端将出错的行列传给服务端。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;eval-&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">通过eval包裹每个模块打包后代码以及对应生成的SourceMap（不实际生成），因为eval中为字符串形式，进行字符串处理会提升rebuild的速度。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;nosources-&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">不包含 sourcesContent 内容，调试时只能看到文件信息和行信息，无法看到源码。</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;cheap-[module-]&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">只定位到源码所在的行，不定位至具体的列，构建速度有所提升。如果只用 cheap ，显示的是 loader 编译之后的源代码，加上 module 后会显示编译之前的源代码。</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">如何选择devtool：</font></p>
<ol>
<li><strong><font style="color:rgb(53, 53, 53);">production：</font></strong><font style="color:rgb(53, 53, 53);">none，source-map，hidden-source-map，nosources-source-map</font></li>
<li><strong><font style="color:rgb(53, 53, 53);">development：</font></strong><font style="color:rgb(53, 53, 53);">eval，eval-source-map，eval-cheap-source-map，eval-cheap-module-source-map</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">开发环境下，需要频繁的修改代码，更多地考虑的开发效率和调试效率，所以更多关注 performance 中 rebuild 的性能。生产环境下，不必过多关注打包性能，主要考虑 quality 代码的保护性、出错的定位速度已经安全性</font></p>
<h2 id="Zfh6G">热替换HMR</h2>

<p><font style="color:rgb(53, 53, 53);">监视模块变动后重新打包、自动刷新会导致页面的一些状态丢失（输入的文本内容），如果能让页面不刷新，模块也能更新，这样的开发体验会好很多</font></p>
<p><font style="color:rgb(53, 53, 53);">模块热替换</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/#devserverhot"><font style="color:rgb(53, 53, 53);">HMR</font></a><font style="color:rgb(53, 53, 53);">(Hot Module Replacement)可以实现无刷更新模块，</font><a target="_blank" rel="noopener" href="https://juejin.cn/post/6870258201384714253"><font style="color:rgb(53, 53, 53);">「webpack 核心特性」模块热替换(HMR)</font></a></p>
<p><font style="color:rgb(53, 53, 53);">HMR作用：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">保留在完全重新加载页面期间丢失的应用程序状态。</font></li>
<li><font style="color:rgb(53, 53, 53);">只更新变更内容，以节省宝贵的开发时间。</font></li>
<li><font style="color:rgb(53, 53, 53);">在源代码中 CSS&#x2F;JS 产生修改时，会立刻在浏览器中进行更新，这几乎相当于在浏览器 devtools 直接更改样式。</font></li>
</ol>
<p><strong>js</strong></p>
<p>使用HMR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">devServer: &#123;<br>  hot: true, // 开启HMR<br>  // 在构建失败时不刷新页面作为回退<br>  // hot: &#x27;only&#x27;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">从webpack-dev-server v4开始，HMR已默认启用。会自动应用HotModuleReplacementPlugin插件</font></p>
<p><strong><font style="color:rgb(53, 53, 53);">注意：</font></strong><font style="color:rgb(53, 53, 53);">HMR并不是开箱即用，还需要使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/hot-module-replacement/"><font style="color:rgb(53, 53, 53);">HMR-API</font></a><font style="color:rgb(53, 53, 53);">手动处理模块的热替换逻辑，否则还会自动刷新，部分loader和插件如style-loader已经处理好了css的热更新逻辑，在Vue等框架下开发，框架本身也处理好了HMR</font></p>
<p><font style="color:rgb(53, 53, 53);">使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/api/hot-module-replacement/"><font style="color:rgb(53, 53, 53);">HMR-API</font></a><font style="color:rgb(53, 53, 53);">手动处理JS模块热替换：</font></p>
<p><strong>js</strong></p>
<p>通常在入口模块统一做处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs plain">if (module.hot) &#123;<br>  module.hot.accept(&#x27;./library.js&#x27;, function() &#123;<br>    // 对更新过的 library 模块做些事情...<br>  &#125;);<br>&#125;<br>// or<br>if (import.meta.webpackHot) &#123;<br>  import.meta.webpackHot.accept(&#x27;./library.js&#x27;, function () &#123;<br>    // Do something with the updated library module…<br>  &#125;);<br>&#125;<br><br>// accept方法<br>module.hot.accept(<br>  dependencies, // 可以是一个字符串或字符串数组<br>  callback // 用于在模块更新后触发的函数<br>  errorHandler // (err, &#123;moduleId, dependencyId&#125;) =&gt; &#123;&#125;<br>);<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">案例：</font></p>
<p><strong>js</strong></p>
<p>src&#x2F;index.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; appendMarkdown &#125; from &quot;./module.js&quot;;<br>import md from &#x27;./01.md&#x27;<br>let mde = appendMarkdown(md);<br><br>if (module.hot) &#123;<br>  // 处理01.md的更新<br>  module.hot.accept(&#x27;./01.md&#x27;, () =&gt; &#123;<br>    // 热重载，先移除原来的<br>    document.body.removeChild(mde);<br>    // 再创建新的<br>    mde = appendMarkdown(md);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">热重载的需要根据自己的业务逻辑去实现，没有通用的方法，这也是webpack没有提供JS模块HMR的原因。</font></p>
<p><font style="color:rgb(53, 53, 53);">打包后，HMR相关代码会被自动去除</font></p>
<h1 id="HfM4W">不同环境的配置</h1>

<p><font style="color:rgb(53, 53, 53);">不同的环境需要不同的webpack配置，主要是区分生产和开发环境，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><font style="color:rgb(53, 53, 53);">区分环境有两种方式</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">配置函数中判断env，返回不同的配置信息</font></li>
<li><font style="color:rgb(53, 53, 53);">创建多个配置文件对应不同的环境（推荐）</font></li>
</ol>
<h2 id="c4N7I">判断env</h2>

<p><font style="color:rgb(53, 53, 53);">webpack配置导出一个函数而非对象，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/configuration-types/#exporting-a-function"><font style="color:rgb(53, 53, 53);">导出函数</font></a><font style="color:rgb(53, 53, 53);">，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/environment-variables/"><font style="color:rgb(53, 53, 53);">环境变量</font></a></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs plain">/**<br> * <br> * @param &#123;string&#125; env 环境名参数<br> * @param &#123;array&#125; argv cli传递的所有参数<br> * @returns &#123;object&#125; webpack配置<br> */<br>module.exports = (env, argv) =&gt; &#123;<br>  console.log(env);<br>  // 默认的通用配置<br>  const config = &#123;<br>    mode: &#x27;none&#x27;,<br>    // 生成源映射以方便调试<br>    devtool: &#x27;eval-source-map&#x27;,<br>    // watch: true,<br>    context: path.resolve(__dirname, &#x27;src&#x27;),<br>    entry: &#123;<br>      main: [&#x27;./index.js&#x27;, &#x27;./main.js&#x27;],<br>    &#125;,<br>    output: &#123;<br>      path: path.resolve(__dirname, &#x27;dist&#x27;),<br>      filename: &#x27;[name]_[contenthash].js&#x27;,<br>      clean: true,<br>    &#125;,<br>    module: &#123;<br>      rules: [<br>        &#123;<br>          // 正则匹配loader要处理的资源<br>          test: /\.css$/i,<br>          // 逆序执行，从右往左<br>          use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],<br>        &#125;,<br>        &#123;<br>          test: /\.(png|jpg|svg|gif|ico)$/,<br>          type: &quot;asset&quot;,<br>          generator: &#123;<br>            filename: &quot;img/[name]_[contenthash][ext]&quot;,<br>          &#125;,<br>          parser: &#123;<br>            dataUrlCondition: &#123;<br>              maxSize: 50 * 1024,//小于50kb进行编码，转为base64<br>            &#125;,<br>          &#125;,<br>        &#125;,<br>        &#123;<br>          test: /\.js$/i,<br>          include: [<br>            path.resolve(__dirname, &#x27;src&#x27;)<br>          ],<br>          exclude: [<br>            path.resolve(__dirname, &#x27;node_modules&#x27;)<br>          ],<br>          loader: &#x27;babel-loader&#x27;,<br>          options: &#123;<br>            presets: [&quot;@babel/preset-env&quot;]<br>          &#125;<br>        &#125;,<br>        &#123;<br>          test: /\.md$/i,<br>          use: path.resolve(__dirname, &#x27;markdown-loader.js&#x27;),<br>        &#125;<br>      ],<br>    &#125;,<br>    plugins: [<br>      new HtmlWebpackPlugin(&#123;<br>        template: path.resolve(__dirname, &#x27;./index.html&#x27;), // 自定义模板<br>        inject: &#x27;body&#x27;, // 插入到body<br>        filename: &#x27;index.html&#x27;, // 输出文件名，默认index.html<br>        title: &#x27;webpack测试&#x27;, // 自定义title，通过&lt;%= htmlWebpackPlugin.options.title %&gt;在html中使用<br>        minify: true, // 压缩<br>      &#125;),<br>    ],<br>    // 配置开发服务器<br>    devServer: &#123;<br>      // 服务器主机<br>      host: &#x27;localhost&#x27;,<br>      // 服务器端口<br>      port: 8080,<br>      // 使用HMR<br>      hot: true,<br>      // 启用Gzip<br>      compress: true,<br>      // CopyPlugin通常只在项目上线时去使用，开发时通常将静态资源目录配置给devServer，以提高性能<br>      // 使用static配置从目录提供静态文件的选项，默认public<br>      static: &#123;<br>        // 告诉服务器从哪里提供内容<br>        directory: path.join(__dirname, &#x27;public&#x27;),<br>      &#125;,<br>      proxy: &#123;<br>        // 代理api路径<br>        &#x27;/api&#x27;: &#123;<br>          // localhost:8080/api/user -&gt; api.github.com/api/user<br>          target: &#x27;https://api.github.com&#x27;,<br>          // 请求路径重写 /api/user -&gt; /user<br>          pathRewrite: &#123; &#x27;^/api&#x27;: &#x27;&#x27; &#125;,<br>          // 将 host 请求头修改为 target 的 URL<br>          changeOrigin: true,<br>        &#125;,<br>      &#125;,<br>    &#125;<br>  &#125;<br>  // 判断环境，修改配置<br>  if (env.production) &#123; // 生产环境<br>    config.mode = &#x27;production&#x27;;<br>    config.devtool = false;<br>    config.plugins = [<br>      ...config.plugins,<br>      new CopyPlugin(&#123;<br>        patterns: [<br>          // 复制public文件夹内的文件到&#123;output&#125;中<br>          &#123; from: path.resolve(__dirname, &#x27;public&#x27;), to: &quot;&quot; &#125;,<br>        ],<br>      &#125;),<br>    ];<br>  &#125; else if (env.development) &#123; // 开发环境<br>    config.mode = &#x27;development&#x27;;<br>  &#125;<br><br>  return config<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>shell</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">npx webpack --env production<br>npx webpack --env development<br></code></pre></td></tr></table></figure>

<h2 id="M29q7">多配置文件</h2>

<p><font style="color:rgb(53, 53, 53);">若项目较大配置复杂，就不适合用判断env的方式，写多个配置文件更清晰明了，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/production/"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><font style="color:rgb(53, 53, 53);">通常有三个配置文件：</font></p>
<ol>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;webpack.common.js&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">通用配置文件，写一些项目的通用基础配置</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;webpack.dev.js&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">开发配置文件</font></li>
<li><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;webpack.prod.js&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);"> </font><font style="color:rgb(53, 53, 53);">生产配置文件</font></li>
</ol>
<p><font style="color:rgb(53, 53, 53);">安装</font><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/webpack-merge"><font style="color:rgb(53, 53, 53);">webpack-merge</font></a><font style="color:rgb(53, 53, 53);">合并配置对象：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i webpack-merge -D&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<p>webpack.common.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs plain">const path = require(&#x27;path&#x27;);<br>const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);<br><br>module.exports = &#123;<br>  mode: &#x27;none&#x27;,<br>  // 生成源映射以方便调试<br>  devtool: &#x27;source-map&#x27;,<br>  // watch: true,<br>  context: path.resolve(__dirname, &#x27;src&#x27;),<br>  entry: &#123;<br>    main: [&#x27;./index.js&#x27;, &#x27;./main.js&#x27;],<br>  &#125;,<br>  output: &#123;<br>    path: path.resolve(__dirname, &#x27;dist&#x27;),<br>    filename: &#x27;[name]_[contenthash].js&#x27;,<br>    clean: true,<br>  &#125;,<br>  //警告 webpack 的性能提示<br>  performance: &#123;<br>    hints: &#x27;warning&#x27;,<br>    //入口起点的最大体积<br>    maxEntrypointSize: 1024 * 1024 * 10,<br>    //生成文件的最大体积<br>    maxAssetSize: 1024 * 1024,<br>    //只给出 js 文件的性能提示<br>    assetFilter: function (assetFilename) &#123;<br>      return /\.js$/.test(assetFilename);<br>    &#125;<br>  &#125;,<br>  module: &#123;<br>    rules: [<br>      &#123;<br>        // 正则匹配loader要处理的资源<br>        test: /\.css$/i,<br>        // 逆序执行，从右往左<br>        use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;],<br>      &#125;,<br>      &#123;<br>        test: /\.(png|jpg|svg|gif|ico)$/,<br>        type: &quot;asset&quot;,<br>        generator: &#123;<br>          filename: &quot;img/[name]_[contenthash][ext]&quot;,<br>        &#125;,<br>        parser: &#123;<br>          dataUrlCondition: &#123;<br>            maxSize: 50 * 1024,//小于50kb进行编码，转为base64<br>          &#125;,<br>        &#125;,<br>      &#125;,<br>      &#123;<br>        test: /\.js$/i,<br>        include: [<br>          path.resolve(__dirname, &#x27;src&#x27;)<br>        ],<br>        exclude: [<br>          path.resolve(__dirname, &#x27;node_modules&#x27;)<br>        ],<br>        loader: &#x27;babel-loader&#x27;,<br>        options: &#123;<br>          presets: [&quot;@babel/preset-env&quot;]<br>        &#125;<br>      &#125;,<br>      &#123;<br>        test: /\.md$/i,<br>        use: path.resolve(__dirname, &#x27;markdown-loader.js&#x27;),<br>      &#125;<br>    ],<br>  &#125;,<br>  plugins: [<br>    new HtmlWebpackPlugin(&#123;<br>      template: path.resolve(__dirname, &#x27;./index.html&#x27;), // 自定义模板<br>      inject: &#x27;body&#x27;, // 插入到body<br>      filename: &#x27;index.html&#x27;, // 输出文件名，默认index.html<br>      title: &#x27;webpack测试&#x27;, // 自定义title，通过&lt;%= htmlWebpackPlugin.options.title %&gt;在html中使用<br>      minify: true, // 压缩<br>    &#125;),<br>  ],<br>  // 配置开发服务器<br>  devServer: &#123;<br>    // 服务器主机<br>    host: &#x27;localhost&#x27;,<br>    // 服务器端口<br>    port: 8080,<br>    // 使用HMR<br>    hot: true,<br>    // 启用Gzip<br>    compress: true,<br>    // CopyPlugin通常只在项目上线时去使用，开发时通常将静态资源目录配置给devServer，以提高性能<br>    // 使用static配置从目录提供静态文件的选项，默认public<br>    static: &#123;<br>      // 告诉服务器从哪里提供内容<br>      directory: path.join(__dirname, &#x27;public&#x27;),<br>    &#125;,<br>    proxy: &#123;<br>      // 代理api路径<br>      &#x27;/api&#x27;: &#123;<br>        // localhost:8080/api/user -&gt; api.github.com/api/user<br>        target: &#x27;https://api.github.com&#x27;,<br>        // 请求路径重写 /api/user -&gt; /user<br>        pathRewrite: &#123; &#x27;^/api&#x27;: &#x27;&#x27; &#125;,<br>        // 将 host 请求头修改为 target 的 URL<br>        changeOrigin: true,<br>      &#125;,<br>    &#125;,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<p>webpack.dev.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">const common = require(&quot;./webpack.common&quot;);<br>const &#123; merge &#125; = require(&quot;webpack-merge&quot;);<br><br>module.exports = merge(common, &#123;<br>  mode: &#x27;development&#x27;,<br>  devtool: &#x27;eval-source-map&#x27;,<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<p>webpack.prod.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">const common = require(&quot;./webpack.common&quot;);<br>const path = require(&#x27;path&#x27;);<br>const CopyPlugin = require(&quot;copy-webpack-plugin&quot;);<br>const &#123; merge &#125; = require(&quot;webpack-merge&quot;);<br><br>module.exports = merge(common, &#123;<br>  mode: &#x27;production&#x27;,<br>  devtool: false,<br>  plugins: [<br>    new CopyPlugin(&#123;<br>      patterns: [<br>        // 复制public文件夹内的文件到&#123;output&#125;中<br>        &#123; from: path.resolve(__dirname, &#x27;public&#x27;), to: &quot;&quot; &#125;,<br>      ],<br>    &#125;),<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">通过 —config 标志使用不同的配置文件</font></p>
<p><strong>json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;scripts&quot;: &#123;<br>  &quot;build&quot;: &quot;webpack --config webpack.prod.js&quot;,<br>  &quot;build-dev&quot;: &quot;webpack --config webpack.dev.js&quot;,<br>  &quot;prod&quot;: &quot;webpack serve --config webpack.prod.js&quot;,<br>  &quot;dev&quot;: &quot;webpack serve --config webpack.dev.js&quot;<br>&#125;,<br></code></pre></td></tr></table></figure>

<h1 id="Fhu5a">内置插件</h1>

<p><font style="color:rgb(53, 53, 53);">webpack本身内置了很多插件对bundle进行优化，且一些插件在</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode: production&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">时会自动开启，进行一些通用的优化操作，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/optimization/"><font style="color:rgb(53, 53, 53);">优化(Optimization)</font></a></p>
<h2 id="iuMQm">DefinePlugin</h2>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/define-plugin/"><font style="color:rgb(53, 53, 53);">DefinePlugin</font></a><font style="color:rgb(53, 53, 53);">用来注入全局成员，在</font><strong><font style="color:rgb(53, 53, 53);">编译时</font></strong><font style="color:rgb(53, 53, 53);">将代码中的变量替换为其他值或表达式</font></p>
<p><font style="color:rgb(53, 53, 53);">在</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode: production&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">时，DefinePlugin默认启用，并注入了</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;process.env.NODE_ENV&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">，许多第三方的模块使用这个常量来判断当前环境</font></p>
<p><font style="color:rgb(53, 53, 53);">DefinePlugin接收一个对象，对象中的值若为字符串，将被作为代码片段使用，</font></p>
<p><strong>js</strong></p>
<p>使用API_BASE_URL区分生产和开发环境API接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">const webpack = require(&#x27;webpack&#x27;);<br><br>plugins: [<br>  new webpack.DefinePlugin(&#123;<br>    // 使用JSON.stringify作为表示字符串的代码片段<br>    API_BASE_URL: JSON.stringify(&#x27;http://api.github.com&#x27;),<br>  &#125;),<br>],<br><br>console.log(API_BASE_URL)<br></code></pre></td></tr></table></figure>

<h2 id="zHa1p">Tree Shaking</h2>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/tree-shaking/"><font style="color:rgb(53, 53, 53);">Tree Shaking</font></a><font style="color:rgb(53, 53, 53);">用于移除JS上下文中的</font><strong><font style="color:rgb(53, 53, 53);">未引用</font></strong><font style="color:rgb(53, 53, 53);">代码(dead-code)，</font><strong><font style="color:rgb(53, 53, 53);">基于ESM</font></strong></p>
<p><font style="color:rgb(53, 53, 53);">在</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode: production&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">时Tree Shaking功能自动开启，也可通过配置开启</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  optimization: &#123;<br>    // 只导出使用了的成员<br>    usedExports: true,<br>  &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">测试代码：</font></p>
<p><strong>js</strong></p>
<p>src&#x2F;utils.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plain">const info = &#123;<br>  name: &#x27;chuckle&#x27;,<br>  age: &#x27;20&#x27;,<br>&#125;<br>export function getName()&#123;<br>  return info.name<br>&#125;<br>export function getAge()&#123;<br>  return info.age<br>&#125;<br>export function logName()&#123;<br>  console.log(info.name);<br>&#125;<br>export function logAge()&#123;<br>  console.log(info.age);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">打包结果，仍然存在未使用的代码片段，这是因为usedExports只是标记了未引用代码，而</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;optimization.minimize&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">才是用于压缩bundle，并去除未引用代码，两者搭配才实现了Tree Shaking</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plain">/* harmony export */ __webpack_require__.d(__webpack_exports__, &#123;<br>/* harmony export */   logName: () =&gt; (/* binding */ logName)<br>/* harmony export */ &#125;);<br>/* unused harmony exports getName, getAge, logAge */<br>var info = &#123;<br>  name: &#x27;chuckle&#x27;,<br>  age: &#x27;20&#x27;<br>&#125;;<br>function getName() &#123;<br>  return info.name;<br>&#125;<br>function getAge() &#123;<br>  return info.age;<br>&#125;<br>function logName() &#123;<br>  var _console;<br>  /* eslint-disable */(_console = console).log.apply(_console, _toConsumableArray(oo_oo(&quot;3634127370_12_2_12_24_4&quot;, info.name)));<br>&#125;<br>function logAge() &#123;<br>  var _console2;<br>  /* eslint-disable */(_console2 = console).log.apply(_console2, _toConsumableArray(oo_oo(&quot;3634127370_15_2_15_23_4&quot;, info.age)));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="rFB9Q">压缩代码去除未引用</h3>

<p><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;optimization.minimize&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">压缩bundle并去除未引用代码，</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;mode: production&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">默认开启</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">module.exports = &#123;<br>  //...<br>  optimization: &#123;<br>    minimize: true,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">打包后，未使用过的代码已经去除</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">e.d(_,&#123;logName:()=&gt;d&#125;);var t=&#123;name:&quot;chuckle&quot;,age:&quot;20&quot;&#125;;<br></code></pre></td></tr></table></figure>

<h3 id="Lnxqo">副作用</h3>

<p><font style="color:rgb(53, 53, 53);">将文件标记为</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/tree-shaking/#mark-the-file-as-side-effect-free"><font style="color:rgb(53, 53, 53);">side-effect-free</font></a><font style="color:rgb(53, 53, 53);">(无副作用)安全地删除未用到的export，目的是为了给Tree Shaking更大的优化空间</font></p>
<p><font style="color:rgb(53, 53, 53);">副作用：模块执行时，除了导出成员之外所作的事情</font></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/optimization/#optimizationsideeffects"><font style="color:rgb(53, 53, 53);">optimization.sideEffects</font></a><font style="color:rgb(53, 53, 53);">告知webpack去辨识package.json中的副作用标记或规则，以跳过那些当导出不被使用且被标记不包含副作用的模块。</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">optimization: &#123;<br>  sideEffects: true, // 开启<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><strong>json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;sideEffects&quot;: false, // 项目所有模块都无副作用<br>// or<br>&quot;sideEffects&quot;: [&quot;*.css&quot;], // 使用css-loader且在css文件中使用import时很有必要<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">常见副作用代码：</font></p>
<p><strong>js</strong></p>
<p>src&#x2F;pad.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">// 数字前补全0<br>Number.prototype.pad = function (size) &#123;<br>  let result = String(this);<br>  while (result.length &lt; size) &#123;<br>    result += &#x27;0&#x27;;<br>  &#125;<br>  return result;<br>&#125;<br><br>// 导入使用<br>import &#x27;./pad&#x27;<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">若没有标记副作用，打包会排除该代码片段</font></p>
<p><strong>text</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">Uncaught TypeError: 8.pad is not a function<br>  at ./main.js (main.js:17:72)<br>  at __webpack_require__ (bootstrap:24:1)<br>  at startup:7:1<br>  at startup:7:1<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">标记副作用</font></p>
<p><strong>json</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">&quot;sideEffects&quot;: [&quot;*.css&quot;, &quot;./src/pad.js&quot;],<br></code></pre></td></tr></table></figure>

<h2 id="R9T71">模块分包</h2>

<p><font style="color:rgb(53, 53, 53);">webpack会将所有小颗粒度的模块，从入口模块开始打包到一个JS模块，若项目较大，bundle也会很大，一些模块可以分包出来，减小bundle的体积，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/code-splitting/"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><font style="color:rgb(53, 53, 53);">模块分包办法：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">多入口打包</font></li>
<li><font style="color:rgb(53, 53, 53);">动态导入</font></li>
</ol>
<h3 id="q8PNg">多入口打包</h3>

<p><font style="color:rgb(53, 53, 53);">多入口打包通常用于多页面应用，但也可以一个页面应用多个bundle，实现分包</font></p>
<p><font style="color:rgb(53, 53, 53);">同事可以使用</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;dependOn&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">指定依赖的公共模块，并在html中引入公共模块</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plain">entry: &#123;<br>  main: &#123;<br>    import: [&#x27;./index.js&#x27;, &#x27;./main.js&#x27;],<br>    dependOn: &#x27;shared&#x27;,<br>  &#125;,<br>  about: &#123;<br>    import: [&#x27;./about.js&#x27;],<br>    dependOn: &#x27;shared&#x27;,<br>  &#125;,<br>  shared: &#x27;./module.js&#x27;,<br>&#125;,<br>output: &#123;<br>  path: path.resolve(__dirname, &#x27;dist&#x27;),<br>  filename: &#x27;[name]_[contenthash].js&#x27;,<br>  clean: true,<br>&#125;,<br>plugins: [<br>  new HtmlWebpackPlugin(&#123;<br>    template: path.resolve(__dirname, &#x27;./index.html&#x27;), // 自定义模板<br>    inject: &#x27;body&#x27;, // 插入到body<br>    filename: &#x27;index.html&#x27;, // 输出文件名，默认index.html<br>    title: &#x27;webpack测试&#x27;, // 自定义title，通过&lt;%= htmlWebpackPlugin.options.title %&gt;在html中使用<br>    minify: true, // 压缩<br>    chunks: [&#x27;main&#x27;, &#x27;shared&#x27;], // 公共模块也要引入<br>  &#125;),<br>  new HtmlWebpackPlugin(&#123;<br>    template: path.resolve(__dirname, &#x27;./about.html&#x27;),<br>    inject: &#x27;body&#x27;,<br>    filename: &#x27;about.html&#x27;,<br>    title: &#x27;关于页&#x27;,<br>    minify: true, // 压缩<br>    chunks: [&#x27;about&#x27;, &#x27;shared&#x27;],<br>  &#125;),<br>],<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">如果想要在一个 HTML 页面上使用多个入口，还需设置</font><font style="color:rgb(53, 53, 53);"> </font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/optimization/#optimizationruntimechunk"><font style="color:rgb(53, 53, 53);">runtimeChunk</font></a></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">optimization: &#123;<br>  // 用于指定运行时(runtime)代码的拆分策略<br>  runtimeChunk: &#x27;single&#x27;,<br>&#125;,<br></code></pre></td></tr></table></figure>

<h3 id="IFW6L">自动提取</h3>

<p><font style="color:rgb(53, 53, 53);">当多个模块引入了同一个模块，可以使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><font style="color:rgb(53, 53, 53);">splitChunks</font></a><font style="color:rgb(53, 53, 53);">将其自动提取为独立的chunk</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">splitChunks: &#123;<br>  chunks: &#x27;all&#x27;,<br>  minSize: 20 * 1024, // 设置最小分包大小,默认20000<br>  minSizeReduction: 50 * 1024, // 需要分包的bundle最小大小<br>&#125;,<br></code></pre></td></tr></table></figure>

<p><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;minSizeReduction&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">：设置需要分包的bundle最小大小，这意味着如果分割成一个 chunk 并没有减少主 chunk（bundle）的给定字节数，它将不会被分割，即使它满足 splitChunks.minSize</font></p>
<p><font style="color:rgb(53, 53, 53);">这样就不用使用</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;dependOn&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">指定依赖的公共模块了</font></p>
<h3 id="zBmI2">动态导入</h3>

<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/code-splitting/#dynamic-imports"><font style="color:rgb(53, 53, 53);">动态导入</font></a><font style="color:rgb(53, 53, 53);">实现按需加载，需要某个模块再加载该模块，所有动态导入的模块都会被自动分包</font></p>
<p><font style="color:rgb(53, 53, 53);">使用ESM的</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;import()&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">实现动态导入</font></p>
<p><font style="color:rgb(53, 53, 53);">下面是一个hash路由的小demo</font></p>
<p><strong>html</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;body&gt;<br>  &lt;header&gt;<br>    &lt;a href=&quot;#Home&quot;&gt;首页&lt;/a&gt;<br>    &lt;a href=&quot;#List&quot;&gt;列表&lt;/a&gt;<br>  &lt;/header&gt;<br>  &lt;div id=&quot;main&quot;&gt;&lt;/div&gt;<br>&lt;/body&gt;<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<p>src&#x2F;blog.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plain">import home from &#x27;./home&#x27;;<br>import list from &#x27;./list&#x27;;<br><br>const render = ()=&gt;&#123;<br>  const hash = window.location.hash || &quot;#Home&quot;;<br>  const mainEle = document.querySelector(&#x27;#main&#x27;);<br>  mainEle.innerHTML = &quot;&quot;;<br>  if(hash === &quot;#List&quot;)&#123;<br>    mainEle.appendChild(list());<br>  &#125;else if(hash === &quot;#Home&quot;)&#123;<br>    mainEle.appendChild(home());<br>  &#125;<br>&#125;<br>render();<br><br>window.addEventListener(&quot;hashchange&quot;, render)<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<p>src&#x2F;home&#x2F;index.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; renderMarkdown &#125; from &quot;../module&quot;;<br>import &#x27;./index.css&#x27;<br>import md from &#x27;./index.md&#x27;<br>export default () =&gt; renderMarkdown(md, &quot;home&quot;);<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<p>src&#x2F;list&#x2F;index.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; renderMarkdown &#125; from &quot;../module&quot;;<br>import &#x27;./index.css&#x27;<br>import md from &#x27;./index.md&#x27;<br>export default () =&gt; renderMarkdown(md, &#x27;list&#x27;);<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">若不使用动态导入，不同路由页引入的css都同时影响样式，导致样式冲突，下面使用</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;import()&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">改造</font></p>
<p><strong>js</strong></p>
<p>src&#x2F;blog.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">const render = () =&gt; &#123;<br>  const hash = window.location.hash || &quot;#Home&quot;;<br>  const mainEle = document.querySelector(&#x27;#main&#x27;);<br>  mainEle.innerHTML = &quot;&quot;;<br>  if (hash === &quot;#List&quot;) &#123;<br>    import(&#x27;./list&#x27;).then((&#123; default: list &#125;) =&gt; &#123;<br>      mainEle.appendChild(list());<br>    &#125;)<br>  &#125; else if (hash === &quot;#Home&quot;) &#123;<br>    import(&#x27;./home&#x27;).then((&#123; default: home &#125;) =&gt; &#123;<br>      mainEle.appendChild(home());<br>    &#125;)<br>  &#125;<br>&#125;<br>render();<br><br>window.addEventListener(&quot;hashchange&quot;, render)<br></code></pre></td></tr></table></figure>

<h3 id="Y3ON1">魔法注释</h3>

<p><font style="color:rgb(53, 53, 53);">在动态导入过程中可以加入魔法注释，控制分包命名、合并、开启</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules"><font style="color:rgb(53, 53, 53);">预加载</font></a></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">// 使用chunkName设置分包命名<br>import(/* webpackChunkName: &quot;home&quot; */&#x27;./home&#x27;)<br>import(/* webpackChunkName: &quot;list&quot; */&#x27;./list&#x27;)<br>// 相同chunkName会被打包到一起<br>import(/* webpackChunkName: &quot;components&quot; */&#x27;./home&#x27;)<br>import(/* webpackChunkName: &quot;components&quot; */&#x27;./list&#x27;)<br>// 开启预加载<br>import(/* webpackPrefetch: true */&#x27;./list&#x27;);<br></code></pre></td></tr></table></figure>

<h1 id="XjBRY">css处理进阶</h1>

<p><font style="color:rgb(53, 53, 53);">css这东西吧，还得琢磨琢磨</font></p>
<h2 id="ijIJ0">css-loader模块化</h2>

<p><font style="color:rgb(53, 53, 53);">开启</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;options.modules&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">，css-loader会将样式中的类名进行转换，根据模块路径和类名生成转换为一个唯一的hash值。</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/loaders/css-loader/#modules"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><strong><font style="color:rgb(53, 53, 53);">作用：</font></strong><font style="color:rgb(53, 53, 53);">CSS的规则都是全局的，任何一个组件的样式规则，都对整个页面有效。产生局部作用域的唯一方法，就是使用一个独一无二的class的名字，不会与其他选择器重名</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">rules: [<br>  &#123;<br>    test: /\.css$/i,<br>    loader: &quot;css-loader&quot;,<br>    options: &#123;<br>      modules: true,<br>    &#125;,<br>  &#125;,<br>],<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">通过导出对象访问类名来应用样式</font></p>
<p><strong>css</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">.list&#123;<br>  background-color: #2f59b4<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">import &#123; renderMarkdown &#125; from &quot;../module&quot;;<br>import css from &#x27;./index.css&#x27;<br>import md from &#x27;./index.md&#x27;<br>export default () =&gt; renderMarkdown(md, css.list);<br></code></pre></td></tr></table></figure>

<h2 id="ROK4P">提取css</h2>

<p><font style="color:rgb(53, 53, 53);">之前css通过style-loader直接应用到style标签内，而css则保存在js模块中，若css体积较大，还是提取css为一个单独的文件好</font></p>
<p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/mini-css-extract-plugin/"><font style="color:rgb(53, 53, 53);">MiniCssExtractPlugin</font></a><font style="color:rgb(53, 53, 53);">将 CSS 提取到单独的文件中，为每个包含 CSS 的 JS 文件创建一个 CSS 文件，并且支持 CSS 和 SourceMaps 的按需加载</font></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i mini-css-extract-plugin -D&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain">const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);<br><br>module.exports = &#123;<br>  plugins: [new MiniCssExtractPlugin()],<br>  module: &#123;<br>    rules: [<br>      &#123;<br>        test: /\.css$/i,<br>        use: [MiniCssExtractPlugin.loader, &quot;css-loader&quot;],<br>      &#125;,<br>    ],<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="mlkJ3">压缩css</h2>

<p><font style="color:rgb(53, 53, 53);">webpack本身只能压缩JS模块,需要压缩CSS等其它类型文件需要安装对应的插件</font></p>
<p><font style="color:rgb(53, 53, 53);">使用</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/plugins/css-minimizer-webpack-plugin/"><font style="color:rgb(53, 53, 53);">CssMinimizerWebpackPlugin</font></a><font style="color:rgb(53, 53, 53);">优化和压缩独立的CSS模块</font></p>
<p><font style="color:rgb(53, 53, 53);">安装：</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm i css-minimizer-webpack-plugin -D&lt;/font&gt;</code></p>
<p><strong>js</strong></p>
<p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">const CssMinimizerPlugin = require(&quot;css-minimizer-webpack-plugin&quot;);<br><br>optimization: &#123;<br>  minimize: true,<br>  // 压缩类的插件应配置在minimizer，受minimize控制<br>  minimizer: [<br>    // 在 webpack@5 中，你可以使用 `...` 语法来扩展现有的 minimizer（即 `terser-webpack-plugin`）<br>    `...`,<br>    new CssMinimizerPlugin(),<br>  ],<br>&#125;,<br></code></pre></td></tr></table></figure>

<h1 id="jiFAz">文件hash</h1>

<p><font style="color:rgb(53, 53, 53);">开启静态资源的客户端缓存后，为了能及时更新资源，资源文件就需要带上hash，</font><a target="_blank" rel="noopener" href="https://webpack.docschina.org/guides/caching/"><font style="color:rgb(53, 53, 53);">文档</font></a></p>
<p><font style="color:rgb(53, 53, 53);">绝大多数插件都支持使用</font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;filename&lt;/font&gt;</code><font style="color:rgb(53, 53, 53);">配置输出的文件名</font></p>
<p><font style="color:rgb(53, 53, 53);">三种hash：</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plain">// [hash]项目级hash，项目中一个模块有变化，该hash就变化<br>filename: &#x27;[name]_[hash].js&#x27;,<br>// [chunkhash]chunk级hash，同一路的打包相同hash<br>filename: &#x27;[name]_[chunkhash].js&#x27;,<br>// [contenthash]文件级hash，根据输出文件内容的hash<br>filename: &#x27;[name]_[contenthash].js&#x27;,<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">指定hash长度</font></p>
<p><strong>js</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">filename: &#x27;[name]_[contenthash:8].js&#x27;,<br></code></pre></td></tr></table></figure>

<p><font style="color:rgb(53, 53, 53);">控制缓存最佳实践：8位contenthash</font></p>
<h1 id="hC4TN">总结</h1>

<p><strong>json</strong></p>
<p>package.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;name&quot;: &quot;webpack01&quot;,<br>  &quot;version&quot;: &quot;1.0.0&quot;,<br>  &quot;description&quot;: &quot;&quot;,<br>  &quot;private&quot;: true,<br>  &quot;scripts&quot;: &#123;<br>    &quot;build&quot;: &quot;webpack --config webpack.prod.js&quot;,<br>    &quot;build-dev&quot;: &quot;webpack --config webpack.dev.js&quot;,<br>    &quot;prod&quot;: &quot;webpack serve --config webpack.prod.js&quot;,<br>    &quot;dev&quot;: &quot;webpack serve --config webpack.dev.js&quot;<br>  &#125;,<br>  &quot;sideEffects&quot;: [<br>    &quot;*.css&quot;,<br>    &quot;./src/pad.js&quot;<br>  ],<br>  &quot;keywords&quot;: [],<br>  &quot;author&quot;: &quot;&quot;,<br>  &quot;license&quot;: &quot;ISC&quot;,<br>  &quot;devDependencies&quot;: &#123;<br>    &quot;@babel/core&quot;: &quot;^7.23.3&quot;,<br>    &quot;@babel/preset-env&quot;: &quot;^7.23.3&quot;,<br>    &quot;babel-loader&quot;: &quot;^8.3.0&quot;,<br>    &quot;copy-webpack-plugin&quot;: &quot;^11.0.0&quot;,<br>    &quot;css-loader&quot;: &quot;^6.8.1&quot;,<br>    &quot;css-minimizer-webpack-plugin&quot;: &quot;^5.0.1&quot;,<br>    &quot;file-loader&quot;: &quot;^6.2.0&quot;,<br>    &quot;html-loader&quot;: &quot;^4.2.0&quot;,<br>    &quot;html-webpack-plugin&quot;: &quot;^5.5.3&quot;,<br>    &quot;marked&quot;: &quot;^9.1.6&quot;,<br>    &quot;mini-css-extract-plugin&quot;: &quot;^2.7.6&quot;,<br>    &quot;style-loader&quot;: &quot;^3.3.3&quot;,<br>    &quot;url-loader&quot;: &quot;^4.1.1&quot;,<br>    &quot;webpack&quot;: &quot;^5.74.0&quot;,<br>    &quot;webpack-bundle-analyzer&quot;: &quot;^4.9.1&quot;,<br>    &quot;webpack-cli&quot;: &quot;^4.10.0&quot;,<br>    &quot;webpack-dev-server&quot;: &quot;^4.15.1&quot;,<br>    &quot;webpack-merge&quot;: &quot;^5.10.0&quot;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h1 id="VmFlU">配置TS环境</h1>

<p><font style="color:rgb(53, 53, 53);">安装TS相关依赖：</font></p>
<ol>
<li><font style="color:rgb(53, 53, 53);">编译TS</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm install ts-loader -D&lt;/font&gt;</code></li>
<li><font style="color:rgb(53, 53, 53);">TS环境</font><font style="color:rgb(53, 53, 53);"> </font><code>&lt;font style=&quot;color:rgb(233, 105, 0);&quot;&gt;npm install typescript -D&lt;/font&gt;</code></li>
</ol>
<p><strong>js</strong></p>
<p>配置webpack.config.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><code class="hljs plain">const path = require(&#x27;path&#x27;);<br>const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;);<br>const webpack = require(&#x27;webpack&#x27;);<br>const MiniCssExtractPlugin = require(&quot;mini-css-extract-plugin&quot;);<br>const CssMinimizerPlugin = require(&quot;css-minimizer-webpack-plugin&quot;);<br><br>module.exports = &#123;<br>  mode: &#x27;none&#x27;,<br>  // 生成源映射以方便调试<br>  devtool: &#x27;source-map&#x27;,<br>  // watch: true,<br>  context: path.resolve(__dirname, &#x27;src&#x27;),<br>  entry: &#123;<br>    main: &#123;<br>      import: [&#x27;./index.ts&#x27;],<br>    &#125;<br>  &#125;,<br>  output: &#123;<br>    path: path.resolve(__dirname, &#x27;dist&#x27;),<br>    filename: &#x27;[name]_[contenthash].js&#x27;,<br>    clean: true,<br>  &#125;,<br>  optimization: &#123;<br>    usedExports: true,<br>    // minimize: true,<br>    // 用于指定运行时(runtime)代码的拆分策略<br>    // runtimeChunk: &#x27;single&#x27;,<br>    // splitChunks: &#123;<br>    //   chunks: &#x27;all&#x27;,<br>    //   minSize: 10 * 1024, // 设置最小分包大小<br>    //   // minSizeReduction: 50 * 1024, // 需要分包的bundle最小大小<br>    // &#125;,<br>    minimizer: [<br>      // 在 webpack@5 中，你可以使用 `...` 语法来扩展现有的 minimizer（即 `terser-webpack-plugin`）<br>      `...`,<br>      new CssMinimizerPlugin(),<br>    ],<br>  &#125;,<br>  //警告 webpack 的性能提示<br>  performance: &#123;<br>    hints: &#x27;warning&#x27;,<br>    //入口起点的最大体积<br>    maxEntrypointSize: 1024 * 1024 * 10,<br>    //生成文件的最大体积<br>    maxAssetSize: 1024 * 1024,<br>    //只给出 js 文件的性能提示<br>    assetFilter: function (assetFilename) &#123;<br>      return /\.ts$/.test(assetFilename);<br>    &#125;<br>  &#125;,<br>  module: &#123;<br>    rules: [<br>      &#123;<br>        // 正则匹配loader要处理的资源<br>        test: /\.css$/i,<br>        // 逆序执行，从右往左<br>        use: [<br>          // &#123;<br>          //   loader: &#x27;style-loader&#x27;,<br>          // &#125;,<br>          &#123;<br>            loader: MiniCssExtractPlugin.loader<br>          &#125;,<br>          &#123;<br>            loader: &#x27;css-loader&#x27;,<br>            // options: &#123;<br>            //   modules: true // css-loader会将样式中的类名进行转换，根据模块路径和类名生成转换为一个唯一的hash值。<br>            // &#125;,<br>          &#125;,<br>        ],<br>      &#125;,<br>      &#123;<br>        test: /\.(png|jpg|svg|gif|ico)$/,<br>        type: &quot;asset&quot;,<br>        generator: &#123;<br>          filename: &quot;img/[name]_[contenthash][ext]&quot;,<br>        &#125;,<br>        parser: &#123;<br>          dataUrlCondition: &#123;<br>            maxSize: 50 * 1024,//小于50kb进行编码，转为base64<br>          &#125;,<br>        &#125;,<br>      &#125;,<br>      &#123;<br>        test: /\.js$/i,<br>        include: [<br>          path.resolve(__dirname, &#x27;src&#x27;)<br>        ],<br>        exclude: [<br>          path.resolve(__dirname, &#x27;node_modules&#x27;)<br>        ],<br>        loader: &#x27;babel-loader&#x27;,<br>        options: &#123;<br>          presets: [&quot;@babel/preset-env&quot;]<br>          // presets: [<br>          //   [&quot;@babel/preset-env&quot;, &#123;<br>          //     modules: &quot;commonjs&quot;, // 开启ESM转CommonJS<br>          //   &#125;]<br>          // ]<br>        &#125;<br>      &#125;,<br>      &#123;<br>        test: /\.ts$/i,<br>        loader: &quot;ts-loader&quot;,<br>        include: [<br>          path.resolve(__dirname, &#x27;src&#x27;)<br>        ],<br>        exclude: [<br>          path.resolve(__dirname, &#x27;node_modules&#x27;)<br>        ],<br>      &#125;<br>    ],<br>  &#125;,<br>  plugins: [<br>    new HtmlWebpackPlugin(&#123;<br>      template: path.resolve(__dirname, &#x27;./index.html&#x27;), // 自定义模板<br>      inject: &#x27;body&#x27;, // 插入到body<br>      filename: &#x27;index.html&#x27;, // 输出文件名，默认index.html<br>      title: &#x27;webpack测试&#x27;, // 自定义title，通过&lt;%= htmlWebpackPlugin.options.title %&gt;在html中使用<br>      minify: true, // 压缩<br>      chunks: [&#x27;main&#x27;],<br>    &#125;),<br>    new webpack.DefinePlugin(&#123;<br>      API_BASE_URL: JSON.stringify(&#x27;http://api.github.com&#x27;),<br>    &#125;),<br>    new MiniCssExtractPlugin(),<br>  ],<br>  resolve: &#123;<br>    extensions: [&#x27;.ts&#x27;, &#x27;.js&#x27;],<br>    alias: &#123;<br>      &#x27;@&#x27;: path.resolve(__dirname, &#x27;./src&#x27;)<br>    &#125;<br>  &#125;,<br>  // 配置开发服务器<br>  devServer: &#123;<br>    // 服务器主机<br>    host: &#x27;localhost&#x27;,<br>    // 服务器端口<br>    port: 8080,<br>    // 使用HMR<br>    hot: true,<br>    // 启用Gzip<br>    compress: true,<br>    // CopyPlugin通常只在项目上线时去使用，开发时通常将静态资源目录配置给devServer，以提高性能<br>    // 使用static配置从目录提供静态文件的选项，默认public<br>    static: &#123;<br>      // 告诉服务器从哪里提供内容<br>      directory: path.join(__dirname, &#x27;public&#x27;),<br>    &#125;,<br>    proxy: &#123;<br>      // 代理api路径<br>      &#x27;/api&#x27;: &#123;<br>        // localhost:8080/api/user -&gt; api.github.com/api/user<br>        target: &#x27;https://api.github.com&#x27;,<br>        // 请求路径重写 /api/user -&gt; /user<br>        pathRewrite: &#123; &#x27;^/api&#x27;: &#x27;&#x27; &#125;,<br>        // 将 host 请求头修改为 target 的 URL<br>        changeOrigin: true,<br>      &#125;,<br>    &#125;,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>json</strong></p>
<p>tsconfig.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs plain">&#123;<br>  &quot;compilerOptions&quot;: &#123;<br>    &quot;incremental&quot;: false, // TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度<br>    // &quot;tsBuildInfoFile&quot;: &quot;./buildFile&quot;, // 增量编译文件的存储位置<br>    &quot;diagnostics&quot;: true, // 打印诊断信息 <br>    &quot;target&quot;: &quot;esnext&quot;, /* 指定 ECMAScript 目标版本：&#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;,&#x27;ES2018&#x27; or &#x27;ESNEXT&#x27;. */<br>    &quot;module&quot;: &quot;esnext&quot;, /* 输出的代码使用什么方式进行模块化： &#x27;none&#x27;, &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27;, &#x27;es2015&#x27;, or &#x27;ESNext&#x27;. */<br>    &quot;lib&quot;: [ /* 指定引用的标准库 */<br>      &quot;esnext&quot;,<br>      &quot;dom&quot;,<br>      &quot;dom.iterable&quot;,<br>    ], // TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入&quot;ES2019.Array&quot;,<br>    &quot;allowJs&quot;: true, // 允许编译器编译JS，JSX文件<br>    &quot;checkJs&quot;: true, // 允许在JS文件中报错，通常与allowJS一起使用<br>    &quot;outDir&quot;: &quot;./dist&quot;, // 指定输出目录<br>    &quot;rootDir&quot;: &quot;./src&quot;, // 指定输出文件目录(用于输出)，用于控制输出目录结构<br>    &quot;declaration&quot;: true, // 生成声明文件，开启后会自动生成声明文件<br>    &quot;declarationDir&quot;: &quot;./dist/typings&quot;, // 指定生成声明文件存放目录<br>    // &quot;emitDeclarationOnly&quot;: true, // 只生成声明文件，而不会生成js文件<br>    &quot;sourceMap&quot;: false, // 生成目标文件的sourceMap文件<br>    // &quot;inlineSourceMap&quot;: true, // 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中<br>    &quot;declarationMap&quot;: false, // 为声明文件生成sourceMap<br>    // &quot;typeRoots&quot;: [], // 声明文件目录，默认时node_modules/@types<br>    &quot;types&quot;: [], // 加载的声明文件包<br>    &quot;removeComments&quot;: true, // 删除注释 <br>    &quot;noEmit&quot;: false, // 不输出文件,即编译后不会生成任何js文件<br>    &quot;noEmitOnError&quot;: true, // 发送错误时不输出任何文件<br>    &quot;noEmitHelpers&quot;: true, // 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用<br>    &quot;importHelpers&quot;: true, // 通过tslib引入helper函数，文件必须是模块<br>    &quot;downlevelIteration&quot;: true, // 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现<br>    &quot;strict&quot;: true, // 开启所有严格的类型检查<br>    &quot;alwaysStrict&quot;: true, // 在代码中注入&#x27;use strict&#x27;<br>    &quot;noImplicitAny&quot;: true, // 不允许隐式的any类型<br>    &quot;strictNullChecks&quot;: true, // 不允许把null、undefined赋值给其他类型的变量<br>    &quot;strictFunctionTypes&quot;: true, // 不允许函数参数双向协变<br>    &quot;strictPropertyInitialization&quot;: true, // 类的实例属性必须初始化<br>    &quot;strictBindCallApply&quot;: true, // 严格的bind/call/apply检查<br>    &quot;noImplicitThis&quot;: true, // 不允许this有隐式的any类型<br>    &quot;noUnusedLocals&quot;: true, // 检查只声明、未使用的局部变量(只提示不报错)<br>    &quot;noUnusedParameters&quot;: true, // 检查未使用的函数参数(只提示不报错)<br>    &quot;noFallthroughCasesInSwitch&quot;: true, // 防止switch语句贯穿(即如果没有break语句后面不会执行)<br>    &quot;noImplicitReturns&quot;: true, //每个分支都会有返回值<br>    &quot;esModuleInterop&quot;: true, // 允许export=导出，由import from 导入<br>    &quot;allowUmdGlobalAccess&quot;: true, // 允许在模块中全局变量的方式访问umd模块<br>    &quot;moduleResolution&quot;: &quot;node&quot;, // 模块解析策略，ts默认用node的解析策略，即相对的方式导入<br>    &quot;baseUrl&quot;: &quot;./&quot;, // 解析非相对模块的基地址，默认是当前目录<br>    &quot;paths&quot;: &#123; // 路径映射，相对于baseUrl<br>      // 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置<br>      // &quot;jquery&quot;: [<br>      //   &quot;node_modules/jquery/dist/jquery.min.js&quot;<br>      // ],<br>      &quot;@/*&quot;: [<br>        &quot;src/*&quot;<br>      ]<br>    &#125;,<br>    &quot;rootDirs&quot;: [<br>      &quot;src&quot;<br>    ], // 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错<br>    &quot;listEmittedFiles&quot;: true, // 打印输出文件<br>    &quot;listFiles&quot;: true, // 打印编译的文件(包括引用的声明文件)<br>    &quot;experimentalDecorators&quot;: true,<br>    &quot;emitDecoratorMetadata&quot;: true,<br>    &quot;resolveJsonModule&quot;: true,<br>    &quot;allowImportingTsExtensions&quot;: true,<br>  &#125;,<br>  // 指定一个匹配列表（属于自动指定该路径下的所有ts相关文件）<br>  &quot;include&quot;: [<br>    &quot;src/**/*&quot;,<br>  ],<br>  // 指定一个排除列表（include的反向操作）<br>  // &quot;exclude&quot;: [<br>  //   &quot;demo.ts&quot;<br>  // ],<br>  // 指定哪些文件使用该配置（属于手动一个个指定文件）<br>  // &quot;files&quot;: [<br>  //   &quot;demo.ts&quot;<br>  // ]<br>&#125;<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%A8%A1%E5%9D%97%E5%8C%96/" class="category-chain-item">模块化</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/" class="print-no-link">#模块化</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>webpack</div>
      <div>http://example.com/2024/12/08/webpack/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>MrZ</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年12月8日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/12/08/foreworld/" title="hexo图片加载问题">
                        <span class="hidden-mobile">hexo图片加载问题</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
